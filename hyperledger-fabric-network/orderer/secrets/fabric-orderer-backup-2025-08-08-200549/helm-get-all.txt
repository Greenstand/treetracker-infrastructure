NAME: fabric-orderer
LAST DEPLOYED: Fri Aug  8 19:37:24 2025
NAMESPACE: hlf-orderer
STATUS: deployed
REVISION: 9
CHART: fabric-orderer
VERSION: 0.1.0
APP_VERSION: 2.5.7
TEST SUITE: None
USER-SUPPLIED VALUES:
null

COMPUTED VALUES:
affinity: {}
fullnameOverride: ""
genesis:
  enabled: false
  fileName: genesis.block
  mountPath: /var/hyperledger/genesis
  secretName: genesis-block
image:
  pullPolicy: IfNotPresent
  repository: hyperledger/fabric-orderer
  tag: 2.5.7
initImage:
  pullPolicy: IfNotPresent
  repository: busybox
  tag: "1.36"
nameOverride: ""
nodeSelector: {}
ordererConfig:
  ChannelParticipation:
    Enabled: true
  Consensus:
    SnapDir: /var/hyperledger/production/orderer/etcdraft/snapshot
    WALDir: /var/hyperledger/production/orderer/etcdraft/wal
  FileLedger:
    Location: /var/hyperledger/production/orderer
  General:
    Cluster:
      ListenPort: 7051
    Keepalive:
      ServerMinInterval: 60s
    ListenAddress: 0.0.0.0
    ListenPort: 7050
    TLS:
      Enabled: true
  Metrics:
    Provider: prometheus
  Operations:
    ListenAddress: 0.0.0.0:9443
orderers:
- mspID: OrdererMSP
  mspSecretName: orderer0-msp
  name: orderer0
  tlsSecretName: orderer0-tls
- mspID: OrdererMSP
  mspSecretName: orderer1-msp
  name: orderer1
  tlsSecretName: orderer1-tls
- mspID: OrdererMSP
  mspSecretName: orderer2-msp
  name: orderer2
  tlsSecretName: orderer2-tls
- mspID: OrdererMSP
  mspSecretName: orderer3-msp
  name: orderer3
  tlsSecretName: orderer3-tls
- mspID: OrdererMSP
  mspSecretName: orderer4-msp
  name: orderer4
  tlsSecretName: orderer4-tls
ports:
  client: 7050
  cluster: 7051
  operations: 9443
probes:
  liveness:
    enabled: true
    failureThreshold: 6
    initialDelaySeconds: 20
    path: /healthz
    periodSeconds: 20
    timeoutSeconds: 5
  readiness:
    enabled: true
    failureThreshold: 6
    initialDelaySeconds: 10
    path: /healthz
    periodSeconds: 10
    timeoutSeconds: 3
resources:
  limits:
    cpu: 1000m
    memory: 2Gi
  requests:
    cpu: 250m
    memory: 512Mi
storage:
  size: 10Gi
  storageClassName: ""
tolerations: []

HOOKS:
MANIFEST:
---
# Source: fabric-orderer/templates/configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: fabric-orderer-config
  labels:
    app.kubernetes.io/name: fabric-orderer
    helm.sh/chart: fabric-orderer-0.1.0
    app.kubernetes.io/instance: fabric-orderer
    app.kubernetes.io/managed-by: Helm
data:
  orderer.yaml: |
    ChannelParticipation:
      Enabled: true
    Consensus:
      SnapDir: /var/hyperledger/production/orderer/etcdraft/snapshot
      WALDir: /var/hyperledger/production/orderer/etcdraft/wal
    FileLedger:
      Location: /var/hyperledger/production/orderer
    General:
      Cluster:
        ListenPort: 7051
      Keepalive:
        ServerMinInterval: 60s
      ListenAddress: 0.0.0.0
      ListenPort: 7050
      TLS:
        Enabled: true
    Metrics:
      Provider: prometheus
    Operations:
      ListenAddress: 0.0.0.0:9443
---
# Source: fabric-orderer/templates/service.yaml
apiVersion: v1
kind: Service
metadata:
  name: orderer0
  labels:
    app.kubernetes.io/name: orderer0
    app.kubernetes.io/component: orderer
    app.kubernetes.io/instance: fabric-orderer
    helm.sh/chart: fabric-orderer-0.1.0
spec:
  type: ClusterIP
  selector:
    app.kubernetes.io/name: orderer0
    app.kubernetes.io/component: orderer
  ports:
    - name: client
      port: 7050
      targetPort: 7050
    - name: cluster
      port: 7051
      targetPort: 7051
    - name: operations
      port: 9443
      targetPort: 9443
---
# Source: fabric-orderer/templates/service.yaml
apiVersion: v1
kind: Service
metadata:
  name: orderer1
  labels:
    app.kubernetes.io/name: orderer1
    app.kubernetes.io/component: orderer
    app.kubernetes.io/instance: fabric-orderer
    helm.sh/chart: fabric-orderer-0.1.0
spec:
  type: ClusterIP
  selector:
    app.kubernetes.io/name: orderer1
    app.kubernetes.io/component: orderer
  ports:
    - name: client
      port: 7050
      targetPort: 7050
    - name: cluster
      port: 7051
      targetPort: 7051
    - name: operations
      port: 9443
      targetPort: 9443
---
# Source: fabric-orderer/templates/service.yaml
apiVersion: v1
kind: Service
metadata:
  name: orderer2
  labels:
    app.kubernetes.io/name: orderer2
    app.kubernetes.io/component: orderer
    app.kubernetes.io/instance: fabric-orderer
    helm.sh/chart: fabric-orderer-0.1.0
spec:
  type: ClusterIP
  selector:
    app.kubernetes.io/name: orderer2
    app.kubernetes.io/component: orderer
  ports:
    - name: client
      port: 7050
      targetPort: 7050
    - name: cluster
      port: 7051
      targetPort: 7051
    - name: operations
      port: 9443
      targetPort: 9443
---
# Source: fabric-orderer/templates/service.yaml
apiVersion: v1
kind: Service
metadata:
  name: orderer3
  labels:
    app.kubernetes.io/name: orderer3
    app.kubernetes.io/component: orderer
    app.kubernetes.io/instance: fabric-orderer
    helm.sh/chart: fabric-orderer-0.1.0
spec:
  type: ClusterIP
  selector:
    app.kubernetes.io/name: orderer3
    app.kubernetes.io/component: orderer
  ports:
    - name: client
      port: 7050
      targetPort: 7050
    - name: cluster
      port: 7051
      targetPort: 7051
    - name: operations
      port: 9443
      targetPort: 9443
---
# Source: fabric-orderer/templates/service.yaml
apiVersion: v1
kind: Service
metadata:
  name: orderer4
  labels:
    app.kubernetes.io/name: orderer4
    app.kubernetes.io/component: orderer
    app.kubernetes.io/instance: fabric-orderer
    helm.sh/chart: fabric-orderer-0.1.0
spec:
  type: ClusterIP
  selector:
    app.kubernetes.io/name: orderer4
    app.kubernetes.io/component: orderer
  ports:
    - name: client
      port: 7050
      targetPort: 7050
    - name: cluster
      port: 7051
      targetPort: 7051
    - name: operations
      port: 9443
      targetPort: 9443
---
# Source: fabric-orderer/templates/statefulset.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: orderer0
  labels:
    app.kubernetes.io/name: orderer0
    app.kubernetes.io/component: orderer
    app.kubernetes.io/instance: fabric-orderer
    helm.sh/chart: fabric-orderer-0.1.0
spec:
  serviceName: orderer0
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: orderer0
      app.kubernetes.io/component: orderer
  template:
    metadata:
      labels:
        app.kubernetes.io/name: orderer0
        app.kubernetes.io/component: orderer
        app.kubernetes.io/instance: fabric-orderer
        helm.sh/chart: fabric-orderer-0.1.0
      annotations:
        # Use root context ($) so included template sees .Values
        checksum/orderer-config: 847267eef1b7741179ab0801a1210d616516545aecfc1494e47dd780d0f587c9
    spec:

      initContainers:
        - name: init-msp-tls
          image: "busybox:1.36"
          imagePullPolicy: IfNotPresent
          command: ["/bin/sh","-c"]
          args:
            - |
              set -euo pipefail

              DEST=/var/hyperledger/orderer
              MSP=${DEST}/msp

              # Create MSP structure
              mkdir -p ${MSP}/cacerts ${MSP}/signcerts ${MSP}/keystore ${MSP}/tlscacerts

              # Copy MSP from secret (supports both structured and flat secrets)
              if [ -d /msp-src/cacerts ] || [ -d /msp-src/signcerts ] || [ -d /msp-src/keystore ]; then
                cp -a /msp-src/cacerts/*   ${MSP}/cacerts/   2>/dev/null || true
                cp -a /msp-src/signcerts/* ${MSP}/signcerts/ 2>/dev/null || true
                cp -a /msp-src/keystore/*  ${MSP}/keystore/  2>/dev/null || true
                [ -f /msp-src/config.yaml ] && cp /msp-src/config.yaml ${MSP}/config.yaml || true
              else
                # Flat secret: reconstruct layout from filenames
                if [ -f /msp-src/cert.pem ]; then
                  cp /msp-src/cert.pem ${MSP}/signcerts/cert.pem
                else
                  FIRST_CERT="$(ls -1 /msp-src/*.pem 2>/dev/null | grep -viE 'ca|root' | head -n1 || true)"
                  [ -n "${FIRST_CERT}" ] && cp "${FIRST_CERT}" ${MSP}/signcerts/cert.pem || true
                fi
                SK="$(ls -1 /msp-src/*_sk 2>/dev/null | head -n1 || true)"
                [ -n "${SK}" ] && cp "${SK}" ${MSP}/keystore/ || true
                for f in /msp-src/*.pem; do
                  [ -e "$f" ] || break
                  bn="$(basename "$f")"
                  echo "$bn" | grep -qiE 'ca|root|cacert' && cp "$f" ${MSP}/cacerts/ || true
                done
                [ -f /msp-src/config.yaml ] && cp /msp-src/config.yaml ${MSP}/config.yaml || true
              fi

              # TLS files (expect normalized names in the TLS secret)
              mkdir -p ${DEST}/tls
              cp /tls-src/server.crt ${DEST}/tls/server.crt
              cp /tls-src/server.key ${DEST}/tls/server.key
              cp /tls-src/ca.crt     ${DEST}/tls/ca.crt

              # Also place TLS CA into MSP tlscacerts (recommended)
              cp ${DEST}/tls/ca.crt ${MSP}/tlscacerts/tls-ca.pem

              # Tighten key perms
              chmod 600 ${MSP}/keystore/* 2>/dev/null || true
          volumeMounts:
            - name: msp-src
              mountPath: /msp-src
              readOnly: true
            - name: tls-src
              mountPath: /tls-src
              readOnly: true
            - name: orderer-writable
              mountPath: /var/hyperledger/orderer

      containers:
        - name: orderer
          image: "hyperledger/fabric-orderer:2.5.7"
          imagePullPolicy: IfNotPresent
          command: ["orderer"]
          env:
            - name: FABRIC_LOGGING_SPEC
              value: "INFO"

            # Listen
            - name: ORDERER_GENERAL_LISTENADDRESS
              value: "0.0.0.0"
            - name: ORDERER_GENERAL_LISTENPORT
              value: "7050"

            # MSP
            - name: ORDERER_GENERAL_LOCALMSPID
              value: "OrdererMSP"
            - name: ORDERER_GENERAL_LOCALMSPDIR
              value: "/var/hyperledger/orderer/msp"

            # TLS
            - name: ORDERER_GENERAL_TLS_ENABLED
              value: "true"
            - name: ORDERER_GENERAL_TLS_PRIVATEKEY
              value: "/var/hyperledger/orderer/tls/server.key"
            - name: ORDERER_GENERAL_TLS_CERTIFICATE
              value: "/var/hyperledger/orderer/tls/server.crt"
            - name: ORDERER_GENERAL_TLS_ROOTCAS
              value: "[/var/hyperledger/orderer/tls/ca.crt]"

            # Cluster (RAFT) - host-only address + separate port (fixes :7051:7051)
            - name: ORDERER_GENERAL_CLUSTER_LISTENADDRESS
              value: "0.0.0.0"
            - name: ORDERER_GENERAL_CLUSTER_LISTENPORT
              value: "7051"
            - name: ORDERER_GENERAL_CLUSTER_SERVERCERTIFICATE
              value: "/var/hyperledger/orderer/tls/server.crt"
            - name: ORDERER_GENERAL_CLUSTER_SERVERPRIVATEKEY
              value: "/var/hyperledger/orderer/tls/server.key"
            - name: ORDERER_GENERAL_CLUSTER_CLIENTCERTIFICATE
              value: "/var/hyperledger/orderer/tls/server.crt"
            - name: ORDERER_GENERAL_CLUSTER_CLIENTPRIVATEKEY
              value: "/var/hyperledger/orderer/tls/server.key"
            - name: ORDERER_GENERAL_CLUSTER_ROOTCAS
              value: "[/var/hyperledger/orderer/tls/ca.crt]"

            # Config file path
            - name: ORDERER_CFGFILE
              value: "/etc/hyperledger/fabric/orderer.yaml"

            # Bootstrap mode (Participation API default)
            - name: ORDERER_GENERAL_BOOTSTRAPMETHOD
              value: "none"

            # Ops & metrics
            - name: ORDERER_OPERATIONS_LISTENADDRESS
              value: "0.0.0.0:9443"
            - name: ORDERER_METRICS_PROVIDER
              value: "prometheus"

          ports:
            - name: client
              containerPort: 7050
            - name: cluster
              containerPort: 7051
            - name: operations
              containerPort: 9443

          volumeMounts:
            - name: orderer-writable
              mountPath: /var/hyperledger/orderer
            - name: ledger
              mountPath: /var/hyperledger/production/orderer
            - name: orderer-config
              mountPath: /etc/hyperledger/fabric
              readOnly: true

          resources:
            limits:
              cpu: 1000m
              memory: 2Gi
            requests:
              cpu: 250m
              memory: 512Mi
          livenessProbe:
            httpGet:
              path: /healthz
              port: operations
            initialDelaySeconds: 20
            periodSeconds: 20
            timeoutSeconds: 5
            failureThreshold: 6
          readinessProbe:
            httpGet:
              path: /healthz
              port: operations
            initialDelaySeconds: 10
            periodSeconds: 10
            timeoutSeconds: 3
            failureThreshold: 6

      volumes:
        - name: orderer-writable
          emptyDir: {}
        - name: orderer-config
          configMap:
            name: fabric-orderer-config
            items:
              - key: orderer.yaml
                path: orderer.yaml
        # Read-only secrets (only init container reads them)
        - name: msp-src
          secret:
            secretName: orderer0-msp
        - name: tls-src
          secret:
            secretName: orderer0-tls

  volumeClaimTemplates:
    - metadata:
        name: ledger
      spec:
        accessModes: ["ReadWriteOnce"]
        resources:
          requests:
            storage: 10Gi
---
# Source: fabric-orderer/templates/statefulset.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: orderer1
  labels:
    app.kubernetes.io/name: orderer1
    app.kubernetes.io/component: orderer
    app.kubernetes.io/instance: fabric-orderer
    helm.sh/chart: fabric-orderer-0.1.0
spec:
  serviceName: orderer1
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: orderer1
      app.kubernetes.io/component: orderer
  template:
    metadata:
      labels:
        app.kubernetes.io/name: orderer1
        app.kubernetes.io/component: orderer
        app.kubernetes.io/instance: fabric-orderer
        helm.sh/chart: fabric-orderer-0.1.0
      annotations:
        # Use root context ($) so included template sees .Values
        checksum/orderer-config: 847267eef1b7741179ab0801a1210d616516545aecfc1494e47dd780d0f587c9
    spec:

      initContainers:
        - name: init-msp-tls
          image: "busybox:1.36"
          imagePullPolicy: IfNotPresent
          command: ["/bin/sh","-c"]
          args:
            - |
              set -euo pipefail

              DEST=/var/hyperledger/orderer
              MSP=${DEST}/msp

              # Create MSP structure
              mkdir -p ${MSP}/cacerts ${MSP}/signcerts ${MSP}/keystore ${MSP}/tlscacerts

              # Copy MSP from secret (supports both structured and flat secrets)
              if [ -d /msp-src/cacerts ] || [ -d /msp-src/signcerts ] || [ -d /msp-src/keystore ]; then
                cp -a /msp-src/cacerts/*   ${MSP}/cacerts/   2>/dev/null || true
                cp -a /msp-src/signcerts/* ${MSP}/signcerts/ 2>/dev/null || true
                cp -a /msp-src/keystore/*  ${MSP}/keystore/  2>/dev/null || true
                [ -f /msp-src/config.yaml ] && cp /msp-src/config.yaml ${MSP}/config.yaml || true
              else
                # Flat secret: reconstruct layout from filenames
                if [ -f /msp-src/cert.pem ]; then
                  cp /msp-src/cert.pem ${MSP}/signcerts/cert.pem
                else
                  FIRST_CERT="$(ls -1 /msp-src/*.pem 2>/dev/null | grep -viE 'ca|root' | head -n1 || true)"
                  [ -n "${FIRST_CERT}" ] && cp "${FIRST_CERT}" ${MSP}/signcerts/cert.pem || true
                fi
                SK="$(ls -1 /msp-src/*_sk 2>/dev/null | head -n1 || true)"
                [ -n "${SK}" ] && cp "${SK}" ${MSP}/keystore/ || true
                for f in /msp-src/*.pem; do
                  [ -e "$f" ] || break
                  bn="$(basename "$f")"
                  echo "$bn" | grep -qiE 'ca|root|cacert' && cp "$f" ${MSP}/cacerts/ || true
                done
                [ -f /msp-src/config.yaml ] && cp /msp-src/config.yaml ${MSP}/config.yaml || true
              fi

              # TLS files (expect normalized names in the TLS secret)
              mkdir -p ${DEST}/tls
              cp /tls-src/server.crt ${DEST}/tls/server.crt
              cp /tls-src/server.key ${DEST}/tls/server.key
              cp /tls-src/ca.crt     ${DEST}/tls/ca.crt

              # Also place TLS CA into MSP tlscacerts (recommended)
              cp ${DEST}/tls/ca.crt ${MSP}/tlscacerts/tls-ca.pem

              # Tighten key perms
              chmod 600 ${MSP}/keystore/* 2>/dev/null || true
          volumeMounts:
            - name: msp-src
              mountPath: /msp-src
              readOnly: true
            - name: tls-src
              mountPath: /tls-src
              readOnly: true
            - name: orderer-writable
              mountPath: /var/hyperledger/orderer

      containers:
        - name: orderer
          image: "hyperledger/fabric-orderer:2.5.7"
          imagePullPolicy: IfNotPresent
          command: ["orderer"]
          env:
            - name: FABRIC_LOGGING_SPEC
              value: "INFO"

            # Listen
            - name: ORDERER_GENERAL_LISTENADDRESS
              value: "0.0.0.0"
            - name: ORDERER_GENERAL_LISTENPORT
              value: "7050"

            # MSP
            - name: ORDERER_GENERAL_LOCALMSPID
              value: "OrdererMSP"
            - name: ORDERER_GENERAL_LOCALMSPDIR
              value: "/var/hyperledger/orderer/msp"

            # TLS
            - name: ORDERER_GENERAL_TLS_ENABLED
              value: "true"
            - name: ORDERER_GENERAL_TLS_PRIVATEKEY
              value: "/var/hyperledger/orderer/tls/server.key"
            - name: ORDERER_GENERAL_TLS_CERTIFICATE
              value: "/var/hyperledger/orderer/tls/server.crt"
            - name: ORDERER_GENERAL_TLS_ROOTCAS
              value: "[/var/hyperledger/orderer/tls/ca.crt]"

            # Cluster (RAFT) - host-only address + separate port (fixes :7051:7051)
            - name: ORDERER_GENERAL_CLUSTER_LISTENADDRESS
              value: "0.0.0.0"
            - name: ORDERER_GENERAL_CLUSTER_LISTENPORT
              value: "7051"
            - name: ORDERER_GENERAL_CLUSTER_SERVERCERTIFICATE
              value: "/var/hyperledger/orderer/tls/server.crt"
            - name: ORDERER_GENERAL_CLUSTER_SERVERPRIVATEKEY
              value: "/var/hyperledger/orderer/tls/server.key"
            - name: ORDERER_GENERAL_CLUSTER_CLIENTCERTIFICATE
              value: "/var/hyperledger/orderer/tls/server.crt"
            - name: ORDERER_GENERAL_CLUSTER_CLIENTPRIVATEKEY
              value: "/var/hyperledger/orderer/tls/server.key"
            - name: ORDERER_GENERAL_CLUSTER_ROOTCAS
              value: "[/var/hyperledger/orderer/tls/ca.crt]"

            # Config file path
            - name: ORDERER_CFGFILE
              value: "/etc/hyperledger/fabric/orderer.yaml"

            # Bootstrap mode (Participation API default)
            - name: ORDERER_GENERAL_BOOTSTRAPMETHOD
              value: "none"

            # Ops & metrics
            - name: ORDERER_OPERATIONS_LISTENADDRESS
              value: "0.0.0.0:9443"
            - name: ORDERER_METRICS_PROVIDER
              value: "prometheus"

          ports:
            - name: client
              containerPort: 7050
            - name: cluster
              containerPort: 7051
            - name: operations
              containerPort: 9443

          volumeMounts:
            - name: orderer-writable
              mountPath: /var/hyperledger/orderer
            - name: ledger
              mountPath: /var/hyperledger/production/orderer
            - name: orderer-config
              mountPath: /etc/hyperledger/fabric
              readOnly: true

          resources:
            limits:
              cpu: 1000m
              memory: 2Gi
            requests:
              cpu: 250m
              memory: 512Mi
          livenessProbe:
            httpGet:
              path: /healthz
              port: operations
            initialDelaySeconds: 20
            periodSeconds: 20
            timeoutSeconds: 5
            failureThreshold: 6
          readinessProbe:
            httpGet:
              path: /healthz
              port: operations
            initialDelaySeconds: 10
            periodSeconds: 10
            timeoutSeconds: 3
            failureThreshold: 6

      volumes:
        - name: orderer-writable
          emptyDir: {}
        - name: orderer-config
          configMap:
            name: fabric-orderer-config
            items:
              - key: orderer.yaml
                path: orderer.yaml
        # Read-only secrets (only init container reads them)
        - name: msp-src
          secret:
            secretName: orderer1-msp
        - name: tls-src
          secret:
            secretName: orderer1-tls

  volumeClaimTemplates:
    - metadata:
        name: ledger
      spec:
        accessModes: ["ReadWriteOnce"]
        resources:
          requests:
            storage: 10Gi
---
# Source: fabric-orderer/templates/statefulset.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: orderer2
  labels:
    app.kubernetes.io/name: orderer2
    app.kubernetes.io/component: orderer
    app.kubernetes.io/instance: fabric-orderer
    helm.sh/chart: fabric-orderer-0.1.0
spec:
  serviceName: orderer2
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: orderer2
      app.kubernetes.io/component: orderer
  template:
    metadata:
      labels:
        app.kubernetes.io/name: orderer2
        app.kubernetes.io/component: orderer
        app.kubernetes.io/instance: fabric-orderer
        helm.sh/chart: fabric-orderer-0.1.0
      annotations:
        # Use root context ($) so included template sees .Values
        checksum/orderer-config: 847267eef1b7741179ab0801a1210d616516545aecfc1494e47dd780d0f587c9
    spec:

      initContainers:
        - name: init-msp-tls
          image: "busybox:1.36"
          imagePullPolicy: IfNotPresent
          command: ["/bin/sh","-c"]
          args:
            - |
              set -euo pipefail

              DEST=/var/hyperledger/orderer
              MSP=${DEST}/msp

              # Create MSP structure
              mkdir -p ${MSP}/cacerts ${MSP}/signcerts ${MSP}/keystore ${MSP}/tlscacerts

              # Copy MSP from secret (supports both structured and flat secrets)
              if [ -d /msp-src/cacerts ] || [ -d /msp-src/signcerts ] || [ -d /msp-src/keystore ]; then
                cp -a /msp-src/cacerts/*   ${MSP}/cacerts/   2>/dev/null || true
                cp -a /msp-src/signcerts/* ${MSP}/signcerts/ 2>/dev/null || true
                cp -a /msp-src/keystore/*  ${MSP}/keystore/  2>/dev/null || true
                [ -f /msp-src/config.yaml ] && cp /msp-src/config.yaml ${MSP}/config.yaml || true
              else
                # Flat secret: reconstruct layout from filenames
                if [ -f /msp-src/cert.pem ]; then
                  cp /msp-src/cert.pem ${MSP}/signcerts/cert.pem
                else
                  FIRST_CERT="$(ls -1 /msp-src/*.pem 2>/dev/null | grep -viE 'ca|root' | head -n1 || true)"
                  [ -n "${FIRST_CERT}" ] && cp "${FIRST_CERT}" ${MSP}/signcerts/cert.pem || true
                fi
                SK="$(ls -1 /msp-src/*_sk 2>/dev/null | head -n1 || true)"
                [ -n "${SK}" ] && cp "${SK}" ${MSP}/keystore/ || true
                for f in /msp-src/*.pem; do
                  [ -e "$f" ] || break
                  bn="$(basename "$f")"
                  echo "$bn" | grep -qiE 'ca|root|cacert' && cp "$f" ${MSP}/cacerts/ || true
                done
                [ -f /msp-src/config.yaml ] && cp /msp-src/config.yaml ${MSP}/config.yaml || true
              fi

              # TLS files (expect normalized names in the TLS secret)
              mkdir -p ${DEST}/tls
              cp /tls-src/server.crt ${DEST}/tls/server.crt
              cp /tls-src/server.key ${DEST}/tls/server.key
              cp /tls-src/ca.crt     ${DEST}/tls/ca.crt

              # Also place TLS CA into MSP tlscacerts (recommended)
              cp ${DEST}/tls/ca.crt ${MSP}/tlscacerts/tls-ca.pem

              # Tighten key perms
              chmod 600 ${MSP}/keystore/* 2>/dev/null || true
          volumeMounts:
            - name: msp-src
              mountPath: /msp-src
              readOnly: true
            - name: tls-src
              mountPath: /tls-src
              readOnly: true
            - name: orderer-writable
              mountPath: /var/hyperledger/orderer

      containers:
        - name: orderer
          image: "hyperledger/fabric-orderer:2.5.7"
          imagePullPolicy: IfNotPresent
          command: ["orderer"]
          env:
            - name: FABRIC_LOGGING_SPEC
              value: "INFO"

            # Listen
            - name: ORDERER_GENERAL_LISTENADDRESS
              value: "0.0.0.0"
            - name: ORDERER_GENERAL_LISTENPORT
              value: "7050"

            # MSP
            - name: ORDERER_GENERAL_LOCALMSPID
              value: "OrdererMSP"
            - name: ORDERER_GENERAL_LOCALMSPDIR
              value: "/var/hyperledger/orderer/msp"

            # TLS
            - name: ORDERER_GENERAL_TLS_ENABLED
              value: "true"
            - name: ORDERER_GENERAL_TLS_PRIVATEKEY
              value: "/var/hyperledger/orderer/tls/server.key"
            - name: ORDERER_GENERAL_TLS_CERTIFICATE
              value: "/var/hyperledger/orderer/tls/server.crt"
            - name: ORDERER_GENERAL_TLS_ROOTCAS
              value: "[/var/hyperledger/orderer/tls/ca.crt]"

            # Cluster (RAFT) - host-only address + separate port (fixes :7051:7051)
            - name: ORDERER_GENERAL_CLUSTER_LISTENADDRESS
              value: "0.0.0.0"
            - name: ORDERER_GENERAL_CLUSTER_LISTENPORT
              value: "7051"
            - name: ORDERER_GENERAL_CLUSTER_SERVERCERTIFICATE
              value: "/var/hyperledger/orderer/tls/server.crt"
            - name: ORDERER_GENERAL_CLUSTER_SERVERPRIVATEKEY
              value: "/var/hyperledger/orderer/tls/server.key"
            - name: ORDERER_GENERAL_CLUSTER_CLIENTCERTIFICATE
              value: "/var/hyperledger/orderer/tls/server.crt"
            - name: ORDERER_GENERAL_CLUSTER_CLIENTPRIVATEKEY
              value: "/var/hyperledger/orderer/tls/server.key"
            - name: ORDERER_GENERAL_CLUSTER_ROOTCAS
              value: "[/var/hyperledger/orderer/tls/ca.crt]"

            # Config file path
            - name: ORDERER_CFGFILE
              value: "/etc/hyperledger/fabric/orderer.yaml"

            # Bootstrap mode (Participation API default)
            - name: ORDERER_GENERAL_BOOTSTRAPMETHOD
              value: "none"

            # Ops & metrics
            - name: ORDERER_OPERATIONS_LISTENADDRESS
              value: "0.0.0.0:9443"
            - name: ORDERER_METRICS_PROVIDER
              value: "prometheus"

          ports:
            - name: client
              containerPort: 7050
            - name: cluster
              containerPort: 7051
            - name: operations
              containerPort: 9443

          volumeMounts:
            - name: orderer-writable
              mountPath: /var/hyperledger/orderer
            - name: ledger
              mountPath: /var/hyperledger/production/orderer
            - name: orderer-config
              mountPath: /etc/hyperledger/fabric
              readOnly: true

          resources:
            limits:
              cpu: 1000m
              memory: 2Gi
            requests:
              cpu: 250m
              memory: 512Mi
          livenessProbe:
            httpGet:
              path: /healthz
              port: operations
            initialDelaySeconds: 20
            periodSeconds: 20
            timeoutSeconds: 5
            failureThreshold: 6
          readinessProbe:
            httpGet:
              path: /healthz
              port: operations
            initialDelaySeconds: 10
            periodSeconds: 10
            timeoutSeconds: 3
            failureThreshold: 6

      volumes:
        - name: orderer-writable
          emptyDir: {}
        - name: orderer-config
          configMap:
            name: fabric-orderer-config
            items:
              - key: orderer.yaml
                path: orderer.yaml
        # Read-only secrets (only init container reads them)
        - name: msp-src
          secret:
            secretName: orderer2-msp
        - name: tls-src
          secret:
            secretName: orderer2-tls

  volumeClaimTemplates:
    - metadata:
        name: ledger
      spec:
        accessModes: ["ReadWriteOnce"]
        resources:
          requests:
            storage: 10Gi
---
# Source: fabric-orderer/templates/statefulset.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: orderer3
  labels:
    app.kubernetes.io/name: orderer3
    app.kubernetes.io/component: orderer
    app.kubernetes.io/instance: fabric-orderer
    helm.sh/chart: fabric-orderer-0.1.0
spec:
  serviceName: orderer3
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: orderer3
      app.kubernetes.io/component: orderer
  template:
    metadata:
      labels:
        app.kubernetes.io/name: orderer3
        app.kubernetes.io/component: orderer
        app.kubernetes.io/instance: fabric-orderer
        helm.sh/chart: fabric-orderer-0.1.0
      annotations:
        # Use root context ($) so included template sees .Values
        checksum/orderer-config: 847267eef1b7741179ab0801a1210d616516545aecfc1494e47dd780d0f587c9
    spec:

      initContainers:
        - name: init-msp-tls
          image: "busybox:1.36"
          imagePullPolicy: IfNotPresent
          command: ["/bin/sh","-c"]
          args:
            - |
              set -euo pipefail

              DEST=/var/hyperledger/orderer
              MSP=${DEST}/msp

              # Create MSP structure
              mkdir -p ${MSP}/cacerts ${MSP}/signcerts ${MSP}/keystore ${MSP}/tlscacerts

              # Copy MSP from secret (supports both structured and flat secrets)
              if [ -d /msp-src/cacerts ] || [ -d /msp-src/signcerts ] || [ -d /msp-src/keystore ]; then
                cp -a /msp-src/cacerts/*   ${MSP}/cacerts/   2>/dev/null || true
                cp -a /msp-src/signcerts/* ${MSP}/signcerts/ 2>/dev/null || true
                cp -a /msp-src/keystore/*  ${MSP}/keystore/  2>/dev/null || true
                [ -f /msp-src/config.yaml ] && cp /msp-src/config.yaml ${MSP}/config.yaml || true
              else
                # Flat secret: reconstruct layout from filenames
                if [ -f /msp-src/cert.pem ]; then
                  cp /msp-src/cert.pem ${MSP}/signcerts/cert.pem
                else
                  FIRST_CERT="$(ls -1 /msp-src/*.pem 2>/dev/null | grep -viE 'ca|root' | head -n1 || true)"
                  [ -n "${FIRST_CERT}" ] && cp "${FIRST_CERT}" ${MSP}/signcerts/cert.pem || true
                fi
                SK="$(ls -1 /msp-src/*_sk 2>/dev/null | head -n1 || true)"
                [ -n "${SK}" ] && cp "${SK}" ${MSP}/keystore/ || true
                for f in /msp-src/*.pem; do
                  [ -e "$f" ] || break
                  bn="$(basename "$f")"
                  echo "$bn" | grep -qiE 'ca|root|cacert' && cp "$f" ${MSP}/cacerts/ || true
                done
                [ -f /msp-src/config.yaml ] && cp /msp-src/config.yaml ${MSP}/config.yaml || true
              fi

              # TLS files (expect normalized names in the TLS secret)
              mkdir -p ${DEST}/tls
              cp /tls-src/server.crt ${DEST}/tls/server.crt
              cp /tls-src/server.key ${DEST}/tls/server.key
              cp /tls-src/ca.crt     ${DEST}/tls/ca.crt

              # Also place TLS CA into MSP tlscacerts (recommended)
              cp ${DEST}/tls/ca.crt ${MSP}/tlscacerts/tls-ca.pem

              # Tighten key perms
              chmod 600 ${MSP}/keystore/* 2>/dev/null || true
          volumeMounts:
            - name: msp-src
              mountPath: /msp-src
              readOnly: true
            - name: tls-src
              mountPath: /tls-src
              readOnly: true
            - name: orderer-writable
              mountPath: /var/hyperledger/orderer

      containers:
        - name: orderer
          image: "hyperledger/fabric-orderer:2.5.7"
          imagePullPolicy: IfNotPresent
          command: ["orderer"]
          env:
            - name: FABRIC_LOGGING_SPEC
              value: "INFO"

            # Listen
            - name: ORDERER_GENERAL_LISTENADDRESS
              value: "0.0.0.0"
            - name: ORDERER_GENERAL_LISTENPORT
              value: "7050"

            # MSP
            - name: ORDERER_GENERAL_LOCALMSPID
              value: "OrdererMSP"
            - name: ORDERER_GENERAL_LOCALMSPDIR
              value: "/var/hyperledger/orderer/msp"

            # TLS
            - name: ORDERER_GENERAL_TLS_ENABLED
              value: "true"
            - name: ORDERER_GENERAL_TLS_PRIVATEKEY
              value: "/var/hyperledger/orderer/tls/server.key"
            - name: ORDERER_GENERAL_TLS_CERTIFICATE
              value: "/var/hyperledger/orderer/tls/server.crt"
            - name: ORDERER_GENERAL_TLS_ROOTCAS
              value: "[/var/hyperledger/orderer/tls/ca.crt]"

            # Cluster (RAFT) - host-only address + separate port (fixes :7051:7051)
            - name: ORDERER_GENERAL_CLUSTER_LISTENADDRESS
              value: "0.0.0.0"
            - name: ORDERER_GENERAL_CLUSTER_LISTENPORT
              value: "7051"
            - name: ORDERER_GENERAL_CLUSTER_SERVERCERTIFICATE
              value: "/var/hyperledger/orderer/tls/server.crt"
            - name: ORDERER_GENERAL_CLUSTER_SERVERPRIVATEKEY
              value: "/var/hyperledger/orderer/tls/server.key"
            - name: ORDERER_GENERAL_CLUSTER_CLIENTCERTIFICATE
              value: "/var/hyperledger/orderer/tls/server.crt"
            - name: ORDERER_GENERAL_CLUSTER_CLIENTPRIVATEKEY
              value: "/var/hyperledger/orderer/tls/server.key"
            - name: ORDERER_GENERAL_CLUSTER_ROOTCAS
              value: "[/var/hyperledger/orderer/tls/ca.crt]"

            # Config file path
            - name: ORDERER_CFGFILE
              value: "/etc/hyperledger/fabric/orderer.yaml"

            # Bootstrap mode (Participation API default)
            - name: ORDERER_GENERAL_BOOTSTRAPMETHOD
              value: "none"

            # Ops & metrics
            - name: ORDERER_OPERATIONS_LISTENADDRESS
              value: "0.0.0.0:9443"
            - name: ORDERER_METRICS_PROVIDER
              value: "prometheus"

          ports:
            - name: client
              containerPort: 7050
            - name: cluster
              containerPort: 7051
            - name: operations
              containerPort: 9443

          volumeMounts:
            - name: orderer-writable
              mountPath: /var/hyperledger/orderer
            - name: ledger
              mountPath: /var/hyperledger/production/orderer
            - name: orderer-config
              mountPath: /etc/hyperledger/fabric
              readOnly: true

          resources:
            limits:
              cpu: 1000m
              memory: 2Gi
            requests:
              cpu: 250m
              memory: 512Mi
          livenessProbe:
            httpGet:
              path: /healthz
              port: operations
            initialDelaySeconds: 20
            periodSeconds: 20
            timeoutSeconds: 5
            failureThreshold: 6
          readinessProbe:
            httpGet:
              path: /healthz
              port: operations
            initialDelaySeconds: 10
            periodSeconds: 10
            timeoutSeconds: 3
            failureThreshold: 6

      volumes:
        - name: orderer-writable
          emptyDir: {}
        - name: orderer-config
          configMap:
            name: fabric-orderer-config
            items:
              - key: orderer.yaml
                path: orderer.yaml
        # Read-only secrets (only init container reads them)
        - name: msp-src
          secret:
            secretName: orderer3-msp
        - name: tls-src
          secret:
            secretName: orderer3-tls

  volumeClaimTemplates:
    - metadata:
        name: ledger
      spec:
        accessModes: ["ReadWriteOnce"]
        resources:
          requests:
            storage: 10Gi
---
# Source: fabric-orderer/templates/statefulset.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: orderer4
  labels:
    app.kubernetes.io/name: orderer4
    app.kubernetes.io/component: orderer
    app.kubernetes.io/instance: fabric-orderer
    helm.sh/chart: fabric-orderer-0.1.0
spec:
  serviceName: orderer4
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: orderer4
      app.kubernetes.io/component: orderer
  template:
    metadata:
      labels:
        app.kubernetes.io/name: orderer4
        app.kubernetes.io/component: orderer
        app.kubernetes.io/instance: fabric-orderer
        helm.sh/chart: fabric-orderer-0.1.0
      annotations:
        # Use root context ($) so included template sees .Values
        checksum/orderer-config: 847267eef1b7741179ab0801a1210d616516545aecfc1494e47dd780d0f587c9
    spec:

      initContainers:
        - name: init-msp-tls
          image: "busybox:1.36"
          imagePullPolicy: IfNotPresent
          command: ["/bin/sh","-c"]
          args:
            - |
              set -euo pipefail

              DEST=/var/hyperledger/orderer
              MSP=${DEST}/msp

              # Create MSP structure
              mkdir -p ${MSP}/cacerts ${MSP}/signcerts ${MSP}/keystore ${MSP}/tlscacerts

              # Copy MSP from secret (supports both structured and flat secrets)
              if [ -d /msp-src/cacerts ] || [ -d /msp-src/signcerts ] || [ -d /msp-src/keystore ]; then
                cp -a /msp-src/cacerts/*   ${MSP}/cacerts/   2>/dev/null || true
                cp -a /msp-src/signcerts/* ${MSP}/signcerts/ 2>/dev/null || true
                cp -a /msp-src/keystore/*  ${MSP}/keystore/  2>/dev/null || true
                [ -f /msp-src/config.yaml ] && cp /msp-src/config.yaml ${MSP}/config.yaml || true
              else
                # Flat secret: reconstruct layout from filenames
                if [ -f /msp-src/cert.pem ]; then
                  cp /msp-src/cert.pem ${MSP}/signcerts/cert.pem
                else
                  FIRST_CERT="$(ls -1 /msp-src/*.pem 2>/dev/null | grep -viE 'ca|root' | head -n1 || true)"
                  [ -n "${FIRST_CERT}" ] && cp "${FIRST_CERT}" ${MSP}/signcerts/cert.pem || true
                fi
                SK="$(ls -1 /msp-src/*_sk 2>/dev/null | head -n1 || true)"
                [ -n "${SK}" ] && cp "${SK}" ${MSP}/keystore/ || true
                for f in /msp-src/*.pem; do
                  [ -e "$f" ] || break
                  bn="$(basename "$f")"
                  echo "$bn" | grep -qiE 'ca|root|cacert' && cp "$f" ${MSP}/cacerts/ || true
                done
                [ -f /msp-src/config.yaml ] && cp /msp-src/config.yaml ${MSP}/config.yaml || true
              fi

              # TLS files (expect normalized names in the TLS secret)
              mkdir -p ${DEST}/tls
              cp /tls-src/server.crt ${DEST}/tls/server.crt
              cp /tls-src/server.key ${DEST}/tls/server.key
              cp /tls-src/ca.crt     ${DEST}/tls/ca.crt

              # Also place TLS CA into MSP tlscacerts (recommended)
              cp ${DEST}/tls/ca.crt ${MSP}/tlscacerts/tls-ca.pem

              # Tighten key perms
              chmod 600 ${MSP}/keystore/* 2>/dev/null || true
          volumeMounts:
            - name: msp-src
              mountPath: /msp-src
              readOnly: true
            - name: tls-src
              mountPath: /tls-src
              readOnly: true
            - name: orderer-writable
              mountPath: /var/hyperledger/orderer

      containers:
        - name: orderer
          image: "hyperledger/fabric-orderer:2.5.7"
          imagePullPolicy: IfNotPresent
          command: ["orderer"]
          env:
            - name: FABRIC_LOGGING_SPEC
              value: "INFO"

            # Listen
            - name: ORDERER_GENERAL_LISTENADDRESS
              value: "0.0.0.0"
            - name: ORDERER_GENERAL_LISTENPORT
              value: "7050"

            # MSP
            - name: ORDERER_GENERAL_LOCALMSPID
              value: "OrdererMSP"
            - name: ORDERER_GENERAL_LOCALMSPDIR
              value: "/var/hyperledger/orderer/msp"

            # TLS
            - name: ORDERER_GENERAL_TLS_ENABLED
              value: "true"
            - name: ORDERER_GENERAL_TLS_PRIVATEKEY
              value: "/var/hyperledger/orderer/tls/server.key"
            - name: ORDERER_GENERAL_TLS_CERTIFICATE
              value: "/var/hyperledger/orderer/tls/server.crt"
            - name: ORDERER_GENERAL_TLS_ROOTCAS
              value: "[/var/hyperledger/orderer/tls/ca.crt]"

            # Cluster (RAFT) - host-only address + separate port (fixes :7051:7051)
            - name: ORDERER_GENERAL_CLUSTER_LISTENADDRESS
              value: "0.0.0.0"
            - name: ORDERER_GENERAL_CLUSTER_LISTENPORT
              value: "7051"
            - name: ORDERER_GENERAL_CLUSTER_SERVERCERTIFICATE
              value: "/var/hyperledger/orderer/tls/server.crt"
            - name: ORDERER_GENERAL_CLUSTER_SERVERPRIVATEKEY
              value: "/var/hyperledger/orderer/tls/server.key"
            - name: ORDERER_GENERAL_CLUSTER_CLIENTCERTIFICATE
              value: "/var/hyperledger/orderer/tls/server.crt"
            - name: ORDERER_GENERAL_CLUSTER_CLIENTPRIVATEKEY
              value: "/var/hyperledger/orderer/tls/server.key"
            - name: ORDERER_GENERAL_CLUSTER_ROOTCAS
              value: "[/var/hyperledger/orderer/tls/ca.crt]"

            # Config file path
            - name: ORDERER_CFGFILE
              value: "/etc/hyperledger/fabric/orderer.yaml"

            # Bootstrap mode (Participation API default)
            - name: ORDERER_GENERAL_BOOTSTRAPMETHOD
              value: "none"

            # Ops & metrics
            - name: ORDERER_OPERATIONS_LISTENADDRESS
              value: "0.0.0.0:9443"
            - name: ORDERER_METRICS_PROVIDER
              value: "prometheus"

          ports:
            - name: client
              containerPort: 7050
            - name: cluster
              containerPort: 7051
            - name: operations
              containerPort: 9443

          volumeMounts:
            - name: orderer-writable
              mountPath: /var/hyperledger/orderer
            - name: ledger
              mountPath: /var/hyperledger/production/orderer
            - name: orderer-config
              mountPath: /etc/hyperledger/fabric
              readOnly: true

          resources:
            limits:
              cpu: 1000m
              memory: 2Gi
            requests:
              cpu: 250m
              memory: 512Mi
          livenessProbe:
            httpGet:
              path: /healthz
              port: operations
            initialDelaySeconds: 20
            periodSeconds: 20
            timeoutSeconds: 5
            failureThreshold: 6
          readinessProbe:
            httpGet:
              path: /healthz
              port: operations
            initialDelaySeconds: 10
            periodSeconds: 10
            timeoutSeconds: 3
            failureThreshold: 6

      volumes:
        - name: orderer-writable
          emptyDir: {}
        - name: orderer-config
          configMap:
            name: fabric-orderer-config
            items:
              - key: orderer.yaml
                path: orderer.yaml
        # Read-only secrets (only init container reads them)
        - name: msp-src
          secret:
            secretName: orderer4-msp
        - name: tls-src
          secret:
            secretName: orderer4-tls

  volumeClaimTemplates:
    - metadata:
        name: ledger
      spec:
        accessModes: ["ReadWriteOnce"]
        resources:
          requests:
            storage: 10Gi

NOTES:
Thanks for installing fabric-orderer!

1) Verify pods:
   kubectl get pods -l app.kubernetes.io/component=orderer -n hlf-orderer

2) Verify services:
   kubectl get svc -l app.kubernetes.io/component=orderer -n hlf-orderer

3) Health checks (Operations endpoint):
   kubectl port-forward svc/orderer0 9443:9443 -n hlf-orderer
   curl http://127.0.0.1:9443/healthz
