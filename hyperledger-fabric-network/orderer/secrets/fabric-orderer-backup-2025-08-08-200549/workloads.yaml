apiVersion: v1
items:
- apiVersion: apps/v1
  kind: StatefulSet
  metadata:
    annotations:
      meta.helm.sh/release-name: fabric-orderer
      meta.helm.sh/release-namespace: hlf-orderer
    creationTimestamp: "2025-08-08T22:59:28Z"
    generation: 5
    labels:
      app.kubernetes.io/component: orderer
      app.kubernetes.io/instance: fabric-orderer
      app.kubernetes.io/managed-by: Helm
      app.kubernetes.io/name: orderer0
      helm.sh/chart: fabric-orderer-0.1.0
    name: orderer0
    namespace: hlf-orderer
    resourceVersion: "876746178"
    uid: 4d5578d5-f7ec-44b8-9404-300d3f2df5e4
  spec:
    persistentVolumeClaimRetentionPolicy:
      whenDeleted: Retain
      whenScaled: Retain
    podManagementPolicy: OrderedReady
    replicas: 1
    revisionHistoryLimit: 10
    selector:
      matchLabels:
        app.kubernetes.io/component: orderer
        app.kubernetes.io/name: orderer0
    serviceName: orderer0
    template:
      metadata:
        annotations:
          checksum/orderer-config: 847267eef1b7741179ab0801a1210d616516545aecfc1494e47dd780d0f587c9
        creationTimestamp: null
        labels:
          app.kubernetes.io/component: orderer
          app.kubernetes.io/instance: fabric-orderer
          app.kubernetes.io/name: orderer0
          helm.sh/chart: fabric-orderer-0.1.0
      spec:
        containers:
        - command:
          - orderer
          env:
          - name: FABRIC_LOGGING_SPEC
            value: INFO
          - name: ORDERER_GENERAL_LISTENADDRESS
            value: 0.0.0.0
          - name: ORDERER_GENERAL_LISTENPORT
            value: "7050"
          - name: ORDERER_GENERAL_LOCALMSPID
            value: OrdererMSP
          - name: ORDERER_GENERAL_LOCALMSPDIR
            value: /var/hyperledger/orderer/msp
          - name: ORDERER_GENERAL_TLS_ENABLED
            value: "true"
          - name: ORDERER_GENERAL_TLS_PRIVATEKEY
            value: /var/hyperledger/orderer/tls/server.key
          - name: ORDERER_GENERAL_TLS_CERTIFICATE
            value: /var/hyperledger/orderer/tls/server.crt
          - name: ORDERER_GENERAL_TLS_ROOTCAS
            value: '[/var/hyperledger/orderer/tls/ca.crt]'
          - name: ORDERER_GENERAL_CLUSTER_LISTENADDRESS
            value: 0.0.0.0
          - name: ORDERER_GENERAL_CLUSTER_LISTENPORT
            value: "7051"
          - name: ORDERER_GENERAL_CLUSTER_SERVERCERTIFICATE
            value: /var/hyperledger/orderer/tls/server.crt
          - name: ORDERER_GENERAL_CLUSTER_SERVERPRIVATEKEY
            value: /var/hyperledger/orderer/tls/server.key
          - name: ORDERER_GENERAL_CLUSTER_CLIENTCERTIFICATE
            value: /var/hyperledger/orderer/tls/server.crt
          - name: ORDERER_GENERAL_CLUSTER_CLIENTPRIVATEKEY
            value: /var/hyperledger/orderer/tls/server.key
          - name: ORDERER_GENERAL_CLUSTER_ROOTCAS
            value: '[/var/hyperledger/orderer/tls/ca.crt]'
          - name: ORDERER_CFGFILE
            value: /etc/hyperledger/fabric/orderer.yaml
          - name: ORDERER_GENERAL_BOOTSTRAPMETHOD
            value: none
          - name: ORDERER_OPERATIONS_LISTENADDRESS
            value: 0.0.0.0:9443
          - name: ORDERER_METRICS_PROVIDER
            value: prometheus
          image: hyperledger/fabric-orderer:2.5.7
          imagePullPolicy: IfNotPresent
          livenessProbe:
            failureThreshold: 6
            httpGet:
              path: /healthz
              port: operations
              scheme: HTTP
            initialDelaySeconds: 20
            periodSeconds: 20
            successThreshold: 1
            timeoutSeconds: 5
          name: orderer
          ports:
          - containerPort: 7050
            name: client
            protocol: TCP
          - containerPort: 7051
            name: cluster
            protocol: TCP
          - containerPort: 9443
            name: operations
            protocol: TCP
          readinessProbe:
            failureThreshold: 6
            httpGet:
              path: /healthz
              port: operations
              scheme: HTTP
            initialDelaySeconds: 10
            periodSeconds: 10
            successThreshold: 1
            timeoutSeconds: 3
          resources:
            limits:
              cpu: "1"
              memory: 2Gi
            requests:
              cpu: 250m
              memory: 512Mi
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
          - mountPath: /var/hyperledger/orderer
            name: orderer-writable
          - mountPath: /var/hyperledger/production/orderer
            name: ledger
          - mountPath: /etc/hyperledger/fabric
            name: orderer-config
            readOnly: true
        dnsPolicy: ClusterFirst
        initContainers:
        - args:
          - |
            set -euo pipefail

            DEST=/var/hyperledger/orderer
            MSP=${DEST}/msp

            # Create MSP structure
            mkdir -p ${MSP}/cacerts ${MSP}/signcerts ${MSP}/keystore ${MSP}/tlscacerts

            # Copy MSP from secret (supports both structured and flat secrets)
            if [ -d /msp-src/cacerts ] || [ -d /msp-src/signcerts ] || [ -d /msp-src/keystore ]; then
              cp -a /msp-src/cacerts/*   ${MSP}/cacerts/   2>/dev/null || true
              cp -a /msp-src/signcerts/* ${MSP}/signcerts/ 2>/dev/null || true
              cp -a /msp-src/keystore/*  ${MSP}/keystore/  2>/dev/null || true
              [ -f /msp-src/config.yaml ] && cp /msp-src/config.yaml ${MSP}/config.yaml || true
            else
              # Flat secret: reconstruct layout from filenames
              if [ -f /msp-src/cert.pem ]; then
                cp /msp-src/cert.pem ${MSP}/signcerts/cert.pem
              else
                FIRST_CERT="$(ls -1 /msp-src/*.pem 2>/dev/null | grep -viE 'ca|root' | head -n1 || true)"
                [ -n "${FIRST_CERT}" ] && cp "${FIRST_CERT}" ${MSP}/signcerts/cert.pem || true
              fi
              SK="$(ls -1 /msp-src/*_sk 2>/dev/null | head -n1 || true)"
              [ -n "${SK}" ] && cp "${SK}" ${MSP}/keystore/ || true
              for f in /msp-src/*.pem; do
                [ -e "$f" ] || break
                bn="$(basename "$f")"
                echo "$bn" | grep -qiE 'ca|root|cacert' && cp "$f" ${MSP}/cacerts/ || true
              done
              [ -f /msp-src/config.yaml ] && cp /msp-src/config.yaml ${MSP}/config.yaml || true
            fi

            # TLS files (expect normalized names in the TLS secret)
            mkdir -p ${DEST}/tls
            cp /tls-src/server.crt ${DEST}/tls/server.crt
            cp /tls-src/server.key ${DEST}/tls/server.key
            cp /tls-src/ca.crt     ${DEST}/tls/ca.crt

            # Also place TLS CA into MSP tlscacerts (recommended)
            cp ${DEST}/tls/ca.crt ${MSP}/tlscacerts/tls-ca.pem

            # Tighten key perms
            chmod 600 ${MSP}/keystore/* 2>/dev/null || true
          command:
          - /bin/sh
          - -c
          image: busybox:1.36
          imagePullPolicy: IfNotPresent
          name: init-msp-tls
          resources: {}
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
          - mountPath: /msp-src
            name: msp-src
            readOnly: true
          - mountPath: /tls-src
            name: tls-src
            readOnly: true
          - mountPath: /var/hyperledger/orderer
            name: orderer-writable
        restartPolicy: Always
        schedulerName: default-scheduler
        securityContext: {}
        terminationGracePeriodSeconds: 30
        volumes:
        - emptyDir: {}
          name: orderer-writable
        - configMap:
            defaultMode: 420
            items:
            - key: orderer.yaml
              path: orderer.yaml
            name: fabric-orderer-config
          name: orderer-config
        - name: msp-src
          secret:
            defaultMode: 420
            secretName: orderer0-msp
        - name: tls-src
          secret:
            defaultMode: 420
            secretName: orderer0-tls
    updateStrategy:
      rollingUpdate:
        partition: 0
      type: RollingUpdate
    volumeClaimTemplates:
    - apiVersion: v1
      kind: PersistentVolumeClaim
      metadata:
        creationTimestamp: null
        name: ledger
      spec:
        accessModes:
        - ReadWriteOnce
        resources:
          requests:
            storage: 10Gi
        volumeMode: Filesystem
      status:
        phase: Pending
  status:
    availableReplicas: 1
    collisionCount: 0
    currentReplicas: 1
    currentRevision: orderer0-65b6b95d
    observedGeneration: 5
    readyReplicas: 1
    replicas: 1
    updateRevision: orderer0-65b6b95d
    updatedReplicas: 1
- apiVersion: apps/v1
  kind: StatefulSet
  metadata:
    annotations:
      meta.helm.sh/release-name: fabric-orderer
      meta.helm.sh/release-namespace: hlf-orderer
    creationTimestamp: "2025-08-08T22:59:28Z"
    generation: 5
    labels:
      app.kubernetes.io/component: orderer
      app.kubernetes.io/instance: fabric-orderer
      app.kubernetes.io/managed-by: Helm
      app.kubernetes.io/name: orderer1
      helm.sh/chart: fabric-orderer-0.1.0
    name: orderer1
    namespace: hlf-orderer
    resourceVersion: "876750484"
    uid: cfa714c5-ad5e-4217-934d-34a18c4db75e
  spec:
    persistentVolumeClaimRetentionPolicy:
      whenDeleted: Retain
      whenScaled: Retain
    podManagementPolicy: OrderedReady
    replicas: 1
    revisionHistoryLimit: 10
    selector:
      matchLabels:
        app.kubernetes.io/component: orderer
        app.kubernetes.io/name: orderer1
    serviceName: orderer1
    template:
      metadata:
        annotations:
          checksum/orderer-config: 847267eef1b7741179ab0801a1210d616516545aecfc1494e47dd780d0f587c9
        creationTimestamp: null
        labels:
          app.kubernetes.io/component: orderer
          app.kubernetes.io/instance: fabric-orderer
          app.kubernetes.io/name: orderer1
          helm.sh/chart: fabric-orderer-0.1.0
      spec:
        containers:
        - command:
          - orderer
          env:
          - name: FABRIC_LOGGING_SPEC
            value: INFO
          - name: ORDERER_GENERAL_LISTENADDRESS
            value: 0.0.0.0
          - name: ORDERER_GENERAL_LISTENPORT
            value: "7050"
          - name: ORDERER_GENERAL_LOCALMSPID
            value: OrdererMSP
          - name: ORDERER_GENERAL_LOCALMSPDIR
            value: /var/hyperledger/orderer/msp
          - name: ORDERER_GENERAL_TLS_ENABLED
            value: "true"
          - name: ORDERER_GENERAL_TLS_PRIVATEKEY
            value: /var/hyperledger/orderer/tls/server.key
          - name: ORDERER_GENERAL_TLS_CERTIFICATE
            value: /var/hyperledger/orderer/tls/server.crt
          - name: ORDERER_GENERAL_TLS_ROOTCAS
            value: '[/var/hyperledger/orderer/tls/ca.crt]'
          - name: ORDERER_GENERAL_CLUSTER_LISTENADDRESS
            value: 0.0.0.0
          - name: ORDERER_GENERAL_CLUSTER_LISTENPORT
            value: "7051"
          - name: ORDERER_GENERAL_CLUSTER_SERVERCERTIFICATE
            value: /var/hyperledger/orderer/tls/server.crt
          - name: ORDERER_GENERAL_CLUSTER_SERVERPRIVATEKEY
            value: /var/hyperledger/orderer/tls/server.key
          - name: ORDERER_GENERAL_CLUSTER_CLIENTCERTIFICATE
            value: /var/hyperledger/orderer/tls/server.crt
          - name: ORDERER_GENERAL_CLUSTER_CLIENTPRIVATEKEY
            value: /var/hyperledger/orderer/tls/server.key
          - name: ORDERER_GENERAL_CLUSTER_ROOTCAS
            value: '[/var/hyperledger/orderer/tls/ca.crt]'
          - name: ORDERER_CFGFILE
            value: /etc/hyperledger/fabric/orderer.yaml
          - name: ORDERER_GENERAL_BOOTSTRAPMETHOD
            value: none
          - name: ORDERER_OPERATIONS_LISTENADDRESS
            value: 0.0.0.0:9443
          - name: ORDERER_METRICS_PROVIDER
            value: prometheus
          image: hyperledger/fabric-orderer:2.5.7
          imagePullPolicy: IfNotPresent
          livenessProbe:
            failureThreshold: 6
            httpGet:
              path: /healthz
              port: operations
              scheme: HTTP
            initialDelaySeconds: 20
            periodSeconds: 20
            successThreshold: 1
            timeoutSeconds: 5
          name: orderer
          ports:
          - containerPort: 7050
            name: client
            protocol: TCP
          - containerPort: 7051
            name: cluster
            protocol: TCP
          - containerPort: 9443
            name: operations
            protocol: TCP
          readinessProbe:
            failureThreshold: 6
            httpGet:
              path: /healthz
              port: operations
              scheme: HTTP
            initialDelaySeconds: 10
            periodSeconds: 10
            successThreshold: 1
            timeoutSeconds: 3
          resources:
            limits:
              cpu: "1"
              memory: 2Gi
            requests:
              cpu: 250m
              memory: 512Mi
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
          - mountPath: /var/hyperledger/orderer
            name: orderer-writable
          - mountPath: /var/hyperledger/production/orderer
            name: ledger
          - mountPath: /etc/hyperledger/fabric
            name: orderer-config
            readOnly: true
        dnsPolicy: ClusterFirst
        initContainers:
        - args:
          - |
            set -euo pipefail

            DEST=/var/hyperledger/orderer
            MSP=${DEST}/msp

            # Create MSP structure
            mkdir -p ${MSP}/cacerts ${MSP}/signcerts ${MSP}/keystore ${MSP}/tlscacerts

            # Copy MSP from secret (supports both structured and flat secrets)
            if [ -d /msp-src/cacerts ] || [ -d /msp-src/signcerts ] || [ -d /msp-src/keystore ]; then
              cp -a /msp-src/cacerts/*   ${MSP}/cacerts/   2>/dev/null || true
              cp -a /msp-src/signcerts/* ${MSP}/signcerts/ 2>/dev/null || true
              cp -a /msp-src/keystore/*  ${MSP}/keystore/  2>/dev/null || true
              [ -f /msp-src/config.yaml ] && cp /msp-src/config.yaml ${MSP}/config.yaml || true
            else
              # Flat secret: reconstruct layout from filenames
              if [ -f /msp-src/cert.pem ]; then
                cp /msp-src/cert.pem ${MSP}/signcerts/cert.pem
              else
                FIRST_CERT="$(ls -1 /msp-src/*.pem 2>/dev/null | grep -viE 'ca|root' | head -n1 || true)"
                [ -n "${FIRST_CERT}" ] && cp "${FIRST_CERT}" ${MSP}/signcerts/cert.pem || true
              fi
              SK="$(ls -1 /msp-src/*_sk 2>/dev/null | head -n1 || true)"
              [ -n "${SK}" ] && cp "${SK}" ${MSP}/keystore/ || true
              for f in /msp-src/*.pem; do
                [ -e "$f" ] || break
                bn="$(basename "$f")"
                echo "$bn" | grep -qiE 'ca|root|cacert' && cp "$f" ${MSP}/cacerts/ || true
              done
              [ -f /msp-src/config.yaml ] && cp /msp-src/config.yaml ${MSP}/config.yaml || true
            fi

            # TLS files (expect normalized names in the TLS secret)
            mkdir -p ${DEST}/tls
            cp /tls-src/server.crt ${DEST}/tls/server.crt
            cp /tls-src/server.key ${DEST}/tls/server.key
            cp /tls-src/ca.crt     ${DEST}/tls/ca.crt

            # Also place TLS CA into MSP tlscacerts (recommended)
            cp ${DEST}/tls/ca.crt ${MSP}/tlscacerts/tls-ca.pem

            # Tighten key perms
            chmod 600 ${MSP}/keystore/* 2>/dev/null || true
          command:
          - /bin/sh
          - -c
          image: busybox:1.36
          imagePullPolicy: IfNotPresent
          name: init-msp-tls
          resources: {}
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
          - mountPath: /msp-src
            name: msp-src
            readOnly: true
          - mountPath: /tls-src
            name: tls-src
            readOnly: true
          - mountPath: /var/hyperledger/orderer
            name: orderer-writable
        restartPolicy: Always
        schedulerName: default-scheduler
        securityContext: {}
        terminationGracePeriodSeconds: 30
        volumes:
        - emptyDir: {}
          name: orderer-writable
        - configMap:
            defaultMode: 420
            items:
            - key: orderer.yaml
              path: orderer.yaml
            name: fabric-orderer-config
          name: orderer-config
        - name: msp-src
          secret:
            defaultMode: 420
            secretName: orderer1-msp
        - name: tls-src
          secret:
            defaultMode: 420
            secretName: orderer1-tls
    updateStrategy:
      rollingUpdate:
        partition: 0
      type: RollingUpdate
    volumeClaimTemplates:
    - apiVersion: v1
      kind: PersistentVolumeClaim
      metadata:
        creationTimestamp: null
        name: ledger
      spec:
        accessModes:
        - ReadWriteOnce
        resources:
          requests:
            storage: 10Gi
        volumeMode: Filesystem
      status:
        phase: Pending
  status:
    availableReplicas: 1
    collisionCount: 0
    currentReplicas: 1
    currentRevision: orderer1-56b8f568bf
    observedGeneration: 5
    readyReplicas: 1
    replicas: 1
    updateRevision: orderer1-56b8f568bf
    updatedReplicas: 1
- apiVersion: apps/v1
  kind: StatefulSet
  metadata:
    annotations:
      meta.helm.sh/release-name: fabric-orderer
      meta.helm.sh/release-namespace: hlf-orderer
    creationTimestamp: "2025-08-08T22:59:29Z"
    generation: 5
    labels:
      app.kubernetes.io/component: orderer
      app.kubernetes.io/instance: fabric-orderer
      app.kubernetes.io/managed-by: Helm
      app.kubernetes.io/name: orderer2
      helm.sh/chart: fabric-orderer-0.1.0
    name: orderer2
    namespace: hlf-orderer
    resourceVersion: "876746324"
    uid: be33322a-a051-46e8-a4b0-1d811f7eb8d5
  spec:
    persistentVolumeClaimRetentionPolicy:
      whenDeleted: Retain
      whenScaled: Retain
    podManagementPolicy: OrderedReady
    replicas: 1
    revisionHistoryLimit: 10
    selector:
      matchLabels:
        app.kubernetes.io/component: orderer
        app.kubernetes.io/name: orderer2
    serviceName: orderer2
    template:
      metadata:
        annotations:
          checksum/orderer-config: 847267eef1b7741179ab0801a1210d616516545aecfc1494e47dd780d0f587c9
        creationTimestamp: null
        labels:
          app.kubernetes.io/component: orderer
          app.kubernetes.io/instance: fabric-orderer
          app.kubernetes.io/name: orderer2
          helm.sh/chart: fabric-orderer-0.1.0
      spec:
        containers:
        - command:
          - orderer
          env:
          - name: FABRIC_LOGGING_SPEC
            value: INFO
          - name: ORDERER_GENERAL_LISTENADDRESS
            value: 0.0.0.0
          - name: ORDERER_GENERAL_LISTENPORT
            value: "7050"
          - name: ORDERER_GENERAL_LOCALMSPID
            value: OrdererMSP
          - name: ORDERER_GENERAL_LOCALMSPDIR
            value: /var/hyperledger/orderer/msp
          - name: ORDERER_GENERAL_TLS_ENABLED
            value: "true"
          - name: ORDERER_GENERAL_TLS_PRIVATEKEY
            value: /var/hyperledger/orderer/tls/server.key
          - name: ORDERER_GENERAL_TLS_CERTIFICATE
            value: /var/hyperledger/orderer/tls/server.crt
          - name: ORDERER_GENERAL_TLS_ROOTCAS
            value: '[/var/hyperledger/orderer/tls/ca.crt]'
          - name: ORDERER_GENERAL_CLUSTER_LISTENADDRESS
            value: 0.0.0.0
          - name: ORDERER_GENERAL_CLUSTER_LISTENPORT
            value: "7051"
          - name: ORDERER_GENERAL_CLUSTER_SERVERCERTIFICATE
            value: /var/hyperledger/orderer/tls/server.crt
          - name: ORDERER_GENERAL_CLUSTER_SERVERPRIVATEKEY
            value: /var/hyperledger/orderer/tls/server.key
          - name: ORDERER_GENERAL_CLUSTER_CLIENTCERTIFICATE
            value: /var/hyperledger/orderer/tls/server.crt
          - name: ORDERER_GENERAL_CLUSTER_CLIENTPRIVATEKEY
            value: /var/hyperledger/orderer/tls/server.key
          - name: ORDERER_GENERAL_CLUSTER_ROOTCAS
            value: '[/var/hyperledger/orderer/tls/ca.crt]'
          - name: ORDERER_CFGFILE
            value: /etc/hyperledger/fabric/orderer.yaml
          - name: ORDERER_GENERAL_BOOTSTRAPMETHOD
            value: none
          - name: ORDERER_OPERATIONS_LISTENADDRESS
            value: 0.0.0.0:9443
          - name: ORDERER_METRICS_PROVIDER
            value: prometheus
          image: hyperledger/fabric-orderer:2.5.7
          imagePullPolicy: IfNotPresent
          livenessProbe:
            failureThreshold: 6
            httpGet:
              path: /healthz
              port: operations
              scheme: HTTP
            initialDelaySeconds: 20
            periodSeconds: 20
            successThreshold: 1
            timeoutSeconds: 5
          name: orderer
          ports:
          - containerPort: 7050
            name: client
            protocol: TCP
          - containerPort: 7051
            name: cluster
            protocol: TCP
          - containerPort: 9443
            name: operations
            protocol: TCP
          readinessProbe:
            failureThreshold: 6
            httpGet:
              path: /healthz
              port: operations
              scheme: HTTP
            initialDelaySeconds: 10
            periodSeconds: 10
            successThreshold: 1
            timeoutSeconds: 3
          resources:
            limits:
              cpu: "1"
              memory: 2Gi
            requests:
              cpu: 250m
              memory: 512Mi
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
          - mountPath: /var/hyperledger/orderer
            name: orderer-writable
          - mountPath: /var/hyperledger/production/orderer
            name: ledger
          - mountPath: /etc/hyperledger/fabric
            name: orderer-config
            readOnly: true
        dnsPolicy: ClusterFirst
        initContainers:
        - args:
          - |
            set -euo pipefail

            DEST=/var/hyperledger/orderer
            MSP=${DEST}/msp

            # Create MSP structure
            mkdir -p ${MSP}/cacerts ${MSP}/signcerts ${MSP}/keystore ${MSP}/tlscacerts

            # Copy MSP from secret (supports both structured and flat secrets)
            if [ -d /msp-src/cacerts ] || [ -d /msp-src/signcerts ] || [ -d /msp-src/keystore ]; then
              cp -a /msp-src/cacerts/*   ${MSP}/cacerts/   2>/dev/null || true
              cp -a /msp-src/signcerts/* ${MSP}/signcerts/ 2>/dev/null || true
              cp -a /msp-src/keystore/*  ${MSP}/keystore/  2>/dev/null || true
              [ -f /msp-src/config.yaml ] && cp /msp-src/config.yaml ${MSP}/config.yaml || true
            else
              # Flat secret: reconstruct layout from filenames
              if [ -f /msp-src/cert.pem ]; then
                cp /msp-src/cert.pem ${MSP}/signcerts/cert.pem
              else
                FIRST_CERT="$(ls -1 /msp-src/*.pem 2>/dev/null | grep -viE 'ca|root' | head -n1 || true)"
                [ -n "${FIRST_CERT}" ] && cp "${FIRST_CERT}" ${MSP}/signcerts/cert.pem || true
              fi
              SK="$(ls -1 /msp-src/*_sk 2>/dev/null | head -n1 || true)"
              [ -n "${SK}" ] && cp "${SK}" ${MSP}/keystore/ || true
              for f in /msp-src/*.pem; do
                [ -e "$f" ] || break
                bn="$(basename "$f")"
                echo "$bn" | grep -qiE 'ca|root|cacert' && cp "$f" ${MSP}/cacerts/ || true
              done
              [ -f /msp-src/config.yaml ] && cp /msp-src/config.yaml ${MSP}/config.yaml || true
            fi

            # TLS files (expect normalized names in the TLS secret)
            mkdir -p ${DEST}/tls
            cp /tls-src/server.crt ${DEST}/tls/server.crt
            cp /tls-src/server.key ${DEST}/tls/server.key
            cp /tls-src/ca.crt     ${DEST}/tls/ca.crt

            # Also place TLS CA into MSP tlscacerts (recommended)
            cp ${DEST}/tls/ca.crt ${MSP}/tlscacerts/tls-ca.pem

            # Tighten key perms
            chmod 600 ${MSP}/keystore/* 2>/dev/null || true
          command:
          - /bin/sh
          - -c
          image: busybox:1.36
          imagePullPolicy: IfNotPresent
          name: init-msp-tls
          resources: {}
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
          - mountPath: /msp-src
            name: msp-src
            readOnly: true
          - mountPath: /tls-src
            name: tls-src
            readOnly: true
          - mountPath: /var/hyperledger/orderer
            name: orderer-writable
        restartPolicy: Always
        schedulerName: default-scheduler
        securityContext: {}
        terminationGracePeriodSeconds: 30
        volumes:
        - emptyDir: {}
          name: orderer-writable
        - configMap:
            defaultMode: 420
            items:
            - key: orderer.yaml
              path: orderer.yaml
            name: fabric-orderer-config
          name: orderer-config
        - name: msp-src
          secret:
            defaultMode: 420
            secretName: orderer2-msp
        - name: tls-src
          secret:
            defaultMode: 420
            secretName: orderer2-tls
    updateStrategy:
      rollingUpdate:
        partition: 0
      type: RollingUpdate
    volumeClaimTemplates:
    - apiVersion: v1
      kind: PersistentVolumeClaim
      metadata:
        creationTimestamp: null
        name: ledger
      spec:
        accessModes:
        - ReadWriteOnce
        resources:
          requests:
            storage: 10Gi
        volumeMode: Filesystem
      status:
        phase: Pending
  status:
    availableReplicas: 1
    collisionCount: 0
    currentReplicas: 1
    currentRevision: orderer2-fcbcf5f5b
    observedGeneration: 5
    readyReplicas: 1
    replicas: 1
    updateRevision: orderer2-fcbcf5f5b
    updatedReplicas: 1
- apiVersion: apps/v1
  kind: StatefulSet
  metadata:
    annotations:
      meta.helm.sh/release-name: fabric-orderer
      meta.helm.sh/release-namespace: hlf-orderer
    creationTimestamp: "2025-08-08T22:59:29Z"
    generation: 5
    labels:
      app.kubernetes.io/component: orderer
      app.kubernetes.io/instance: fabric-orderer
      app.kubernetes.io/managed-by: Helm
      app.kubernetes.io/name: orderer3
      helm.sh/chart: fabric-orderer-0.1.0
    name: orderer3
    namespace: hlf-orderer
    resourceVersion: "876746331"
    uid: 61d4b921-942f-4777-a7e4-a2db20965276
  spec:
    persistentVolumeClaimRetentionPolicy:
      whenDeleted: Retain
      whenScaled: Retain
    podManagementPolicy: OrderedReady
    replicas: 1
    revisionHistoryLimit: 10
    selector:
      matchLabels:
        app.kubernetes.io/component: orderer
        app.kubernetes.io/name: orderer3
    serviceName: orderer3
    template:
      metadata:
        annotations:
          checksum/orderer-config: 847267eef1b7741179ab0801a1210d616516545aecfc1494e47dd780d0f587c9
        creationTimestamp: null
        labels:
          app.kubernetes.io/component: orderer
          app.kubernetes.io/instance: fabric-orderer
          app.kubernetes.io/name: orderer3
          helm.sh/chart: fabric-orderer-0.1.0
      spec:
        containers:
        - command:
          - orderer
          env:
          - name: FABRIC_LOGGING_SPEC
            value: INFO
          - name: ORDERER_GENERAL_LISTENADDRESS
            value: 0.0.0.0
          - name: ORDERER_GENERAL_LISTENPORT
            value: "7050"
          - name: ORDERER_GENERAL_LOCALMSPID
            value: OrdererMSP
          - name: ORDERER_GENERAL_LOCALMSPDIR
            value: /var/hyperledger/orderer/msp
          - name: ORDERER_GENERAL_TLS_ENABLED
            value: "true"
          - name: ORDERER_GENERAL_TLS_PRIVATEKEY
            value: /var/hyperledger/orderer/tls/server.key
          - name: ORDERER_GENERAL_TLS_CERTIFICATE
            value: /var/hyperledger/orderer/tls/server.crt
          - name: ORDERER_GENERAL_TLS_ROOTCAS
            value: '[/var/hyperledger/orderer/tls/ca.crt]'
          - name: ORDERER_GENERAL_CLUSTER_LISTENADDRESS
            value: 0.0.0.0
          - name: ORDERER_GENERAL_CLUSTER_LISTENPORT
            value: "7051"
          - name: ORDERER_GENERAL_CLUSTER_SERVERCERTIFICATE
            value: /var/hyperledger/orderer/tls/server.crt
          - name: ORDERER_GENERAL_CLUSTER_SERVERPRIVATEKEY
            value: /var/hyperledger/orderer/tls/server.key
          - name: ORDERER_GENERAL_CLUSTER_CLIENTCERTIFICATE
            value: /var/hyperledger/orderer/tls/server.crt
          - name: ORDERER_GENERAL_CLUSTER_CLIENTPRIVATEKEY
            value: /var/hyperledger/orderer/tls/server.key
          - name: ORDERER_GENERAL_CLUSTER_ROOTCAS
            value: '[/var/hyperledger/orderer/tls/ca.crt]'
          - name: ORDERER_CFGFILE
            value: /etc/hyperledger/fabric/orderer.yaml
          - name: ORDERER_GENERAL_BOOTSTRAPMETHOD
            value: none
          - name: ORDERER_OPERATIONS_LISTENADDRESS
            value: 0.0.0.0:9443
          - name: ORDERER_METRICS_PROVIDER
            value: prometheus
          image: hyperledger/fabric-orderer:2.5.7
          imagePullPolicy: IfNotPresent
          livenessProbe:
            failureThreshold: 6
            httpGet:
              path: /healthz
              port: operations
              scheme: HTTP
            initialDelaySeconds: 20
            periodSeconds: 20
            successThreshold: 1
            timeoutSeconds: 5
          name: orderer
          ports:
          - containerPort: 7050
            name: client
            protocol: TCP
          - containerPort: 7051
            name: cluster
            protocol: TCP
          - containerPort: 9443
            name: operations
            protocol: TCP
          readinessProbe:
            failureThreshold: 6
            httpGet:
              path: /healthz
              port: operations
              scheme: HTTP
            initialDelaySeconds: 10
            periodSeconds: 10
            successThreshold: 1
            timeoutSeconds: 3
          resources:
            limits:
              cpu: "1"
              memory: 2Gi
            requests:
              cpu: 250m
              memory: 512Mi
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
          - mountPath: /var/hyperledger/orderer
            name: orderer-writable
          - mountPath: /var/hyperledger/production/orderer
            name: ledger
          - mountPath: /etc/hyperledger/fabric
            name: orderer-config
            readOnly: true
        dnsPolicy: ClusterFirst
        initContainers:
        - args:
          - |
            set -euo pipefail

            DEST=/var/hyperledger/orderer
            MSP=${DEST}/msp

            # Create MSP structure
            mkdir -p ${MSP}/cacerts ${MSP}/signcerts ${MSP}/keystore ${MSP}/tlscacerts

            # Copy MSP from secret (supports both structured and flat secrets)
            if [ -d /msp-src/cacerts ] || [ -d /msp-src/signcerts ] || [ -d /msp-src/keystore ]; then
              cp -a /msp-src/cacerts/*   ${MSP}/cacerts/   2>/dev/null || true
              cp -a /msp-src/signcerts/* ${MSP}/signcerts/ 2>/dev/null || true
              cp -a /msp-src/keystore/*  ${MSP}/keystore/  2>/dev/null || true
              [ -f /msp-src/config.yaml ] && cp /msp-src/config.yaml ${MSP}/config.yaml || true
            else
              # Flat secret: reconstruct layout from filenames
              if [ -f /msp-src/cert.pem ]; then
                cp /msp-src/cert.pem ${MSP}/signcerts/cert.pem
              else
                FIRST_CERT="$(ls -1 /msp-src/*.pem 2>/dev/null | grep -viE 'ca|root' | head -n1 || true)"
                [ -n "${FIRST_CERT}" ] && cp "${FIRST_CERT}" ${MSP}/signcerts/cert.pem || true
              fi
              SK="$(ls -1 /msp-src/*_sk 2>/dev/null | head -n1 || true)"
              [ -n "${SK}" ] && cp "${SK}" ${MSP}/keystore/ || true
              for f in /msp-src/*.pem; do
                [ -e "$f" ] || break
                bn="$(basename "$f")"
                echo "$bn" | grep -qiE 'ca|root|cacert' && cp "$f" ${MSP}/cacerts/ || true
              done
              [ -f /msp-src/config.yaml ] && cp /msp-src/config.yaml ${MSP}/config.yaml || true
            fi

            # TLS files (expect normalized names in the TLS secret)
            mkdir -p ${DEST}/tls
            cp /tls-src/server.crt ${DEST}/tls/server.crt
            cp /tls-src/server.key ${DEST}/tls/server.key
            cp /tls-src/ca.crt     ${DEST}/tls/ca.crt

            # Also place TLS CA into MSP tlscacerts (recommended)
            cp ${DEST}/tls/ca.crt ${MSP}/tlscacerts/tls-ca.pem

            # Tighten key perms
            chmod 600 ${MSP}/keystore/* 2>/dev/null || true
          command:
          - /bin/sh
          - -c
          image: busybox:1.36
          imagePullPolicy: IfNotPresent
          name: init-msp-tls
          resources: {}
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
          - mountPath: /msp-src
            name: msp-src
            readOnly: true
          - mountPath: /tls-src
            name: tls-src
            readOnly: true
          - mountPath: /var/hyperledger/orderer
            name: orderer-writable
        restartPolicy: Always
        schedulerName: default-scheduler
        securityContext: {}
        terminationGracePeriodSeconds: 30
        volumes:
        - emptyDir: {}
          name: orderer-writable
        - configMap:
            defaultMode: 420
            items:
            - key: orderer.yaml
              path: orderer.yaml
            name: fabric-orderer-config
          name: orderer-config
        - name: msp-src
          secret:
            defaultMode: 420
            secretName: orderer3-msp
        - name: tls-src
          secret:
            defaultMode: 420
            secretName: orderer3-tls
    updateStrategy:
      rollingUpdate:
        partition: 0
      type: RollingUpdate
    volumeClaimTemplates:
    - apiVersion: v1
      kind: PersistentVolumeClaim
      metadata:
        creationTimestamp: null
        name: ledger
      spec:
        accessModes:
        - ReadWriteOnce
        resources:
          requests:
            storage: 10Gi
        volumeMode: Filesystem
      status:
        phase: Pending
  status:
    availableReplicas: 1
    collisionCount: 0
    currentReplicas: 1
    currentRevision: orderer3-c564f5559
    observedGeneration: 5
    readyReplicas: 1
    replicas: 1
    updateRevision: orderer3-c564f5559
    updatedReplicas: 1
- apiVersion: apps/v1
  kind: StatefulSet
  metadata:
    annotations:
      meta.helm.sh/release-name: fabric-orderer
      meta.helm.sh/release-namespace: hlf-orderer
    creationTimestamp: "2025-08-08T22:59:29Z"
    generation: 5
    labels:
      app.kubernetes.io/component: orderer
      app.kubernetes.io/instance: fabric-orderer
      app.kubernetes.io/managed-by: Helm
      app.kubernetes.io/name: orderer4
      helm.sh/chart: fabric-orderer-0.1.0
    name: orderer4
    namespace: hlf-orderer
    resourceVersion: "876746312"
    uid: a3d29e1d-72b0-499a-b7c7-9dd367445ef6
  spec:
    persistentVolumeClaimRetentionPolicy:
      whenDeleted: Retain
      whenScaled: Retain
    podManagementPolicy: OrderedReady
    replicas: 1
    revisionHistoryLimit: 10
    selector:
      matchLabels:
        app.kubernetes.io/component: orderer
        app.kubernetes.io/name: orderer4
    serviceName: orderer4
    template:
      metadata:
        annotations:
          checksum/orderer-config: 847267eef1b7741179ab0801a1210d616516545aecfc1494e47dd780d0f587c9
        creationTimestamp: null
        labels:
          app.kubernetes.io/component: orderer
          app.kubernetes.io/instance: fabric-orderer
          app.kubernetes.io/name: orderer4
          helm.sh/chart: fabric-orderer-0.1.0
      spec:
        containers:
        - command:
          - orderer
          env:
          - name: FABRIC_LOGGING_SPEC
            value: INFO
          - name: ORDERER_GENERAL_LISTENADDRESS
            value: 0.0.0.0
          - name: ORDERER_GENERAL_LISTENPORT
            value: "7050"
          - name: ORDERER_GENERAL_LOCALMSPID
            value: OrdererMSP
          - name: ORDERER_GENERAL_LOCALMSPDIR
            value: /var/hyperledger/orderer/msp
          - name: ORDERER_GENERAL_TLS_ENABLED
            value: "true"
          - name: ORDERER_GENERAL_TLS_PRIVATEKEY
            value: /var/hyperledger/orderer/tls/server.key
          - name: ORDERER_GENERAL_TLS_CERTIFICATE
            value: /var/hyperledger/orderer/tls/server.crt
          - name: ORDERER_GENERAL_TLS_ROOTCAS
            value: '[/var/hyperledger/orderer/tls/ca.crt]'
          - name: ORDERER_GENERAL_CLUSTER_LISTENADDRESS
            value: 0.0.0.0
          - name: ORDERER_GENERAL_CLUSTER_LISTENPORT
            value: "7051"
          - name: ORDERER_GENERAL_CLUSTER_SERVERCERTIFICATE
            value: /var/hyperledger/orderer/tls/server.crt
          - name: ORDERER_GENERAL_CLUSTER_SERVERPRIVATEKEY
            value: /var/hyperledger/orderer/tls/server.key
          - name: ORDERER_GENERAL_CLUSTER_CLIENTCERTIFICATE
            value: /var/hyperledger/orderer/tls/server.crt
          - name: ORDERER_GENERAL_CLUSTER_CLIENTPRIVATEKEY
            value: /var/hyperledger/orderer/tls/server.key
          - name: ORDERER_GENERAL_CLUSTER_ROOTCAS
            value: '[/var/hyperledger/orderer/tls/ca.crt]'
          - name: ORDERER_CFGFILE
            value: /etc/hyperledger/fabric/orderer.yaml
          - name: ORDERER_GENERAL_BOOTSTRAPMETHOD
            value: none
          - name: ORDERER_OPERATIONS_LISTENADDRESS
            value: 0.0.0.0:9443
          - name: ORDERER_METRICS_PROVIDER
            value: prometheus
          image: hyperledger/fabric-orderer:2.5.7
          imagePullPolicy: IfNotPresent
          livenessProbe:
            failureThreshold: 6
            httpGet:
              path: /healthz
              port: operations
              scheme: HTTP
            initialDelaySeconds: 20
            periodSeconds: 20
            successThreshold: 1
            timeoutSeconds: 5
          name: orderer
          ports:
          - containerPort: 7050
            name: client
            protocol: TCP
          - containerPort: 7051
            name: cluster
            protocol: TCP
          - containerPort: 9443
            name: operations
            protocol: TCP
          readinessProbe:
            failureThreshold: 6
            httpGet:
              path: /healthz
              port: operations
              scheme: HTTP
            initialDelaySeconds: 10
            periodSeconds: 10
            successThreshold: 1
            timeoutSeconds: 3
          resources:
            limits:
              cpu: "1"
              memory: 2Gi
            requests:
              cpu: 250m
              memory: 512Mi
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
          - mountPath: /var/hyperledger/orderer
            name: orderer-writable
          - mountPath: /var/hyperledger/production/orderer
            name: ledger
          - mountPath: /etc/hyperledger/fabric
            name: orderer-config
            readOnly: true
        dnsPolicy: ClusterFirst
        initContainers:
        - args:
          - |
            set -euo pipefail

            DEST=/var/hyperledger/orderer
            MSP=${DEST}/msp

            # Create MSP structure
            mkdir -p ${MSP}/cacerts ${MSP}/signcerts ${MSP}/keystore ${MSP}/tlscacerts

            # Copy MSP from secret (supports both structured and flat secrets)
            if [ -d /msp-src/cacerts ] || [ -d /msp-src/signcerts ] || [ -d /msp-src/keystore ]; then
              cp -a /msp-src/cacerts/*   ${MSP}/cacerts/   2>/dev/null || true
              cp -a /msp-src/signcerts/* ${MSP}/signcerts/ 2>/dev/null || true
              cp -a /msp-src/keystore/*  ${MSP}/keystore/  2>/dev/null || true
              [ -f /msp-src/config.yaml ] && cp /msp-src/config.yaml ${MSP}/config.yaml || true
            else
              # Flat secret: reconstruct layout from filenames
              if [ -f /msp-src/cert.pem ]; then
                cp /msp-src/cert.pem ${MSP}/signcerts/cert.pem
              else
                FIRST_CERT="$(ls -1 /msp-src/*.pem 2>/dev/null | grep -viE 'ca|root' | head -n1 || true)"
                [ -n "${FIRST_CERT}" ] && cp "${FIRST_CERT}" ${MSP}/signcerts/cert.pem || true
              fi
              SK="$(ls -1 /msp-src/*_sk 2>/dev/null | head -n1 || true)"
              [ -n "${SK}" ] && cp "${SK}" ${MSP}/keystore/ || true
              for f in /msp-src/*.pem; do
                [ -e "$f" ] || break
                bn="$(basename "$f")"
                echo "$bn" | grep -qiE 'ca|root|cacert' && cp "$f" ${MSP}/cacerts/ || true
              done
              [ -f /msp-src/config.yaml ] && cp /msp-src/config.yaml ${MSP}/config.yaml || true
            fi

            # TLS files (expect normalized names in the TLS secret)
            mkdir -p ${DEST}/tls
            cp /tls-src/server.crt ${DEST}/tls/server.crt
            cp /tls-src/server.key ${DEST}/tls/server.key
            cp /tls-src/ca.crt     ${DEST}/tls/ca.crt

            # Also place TLS CA into MSP tlscacerts (recommended)
            cp ${DEST}/tls/ca.crt ${MSP}/tlscacerts/tls-ca.pem

            # Tighten key perms
            chmod 600 ${MSP}/keystore/* 2>/dev/null || true
          command:
          - /bin/sh
          - -c
          image: busybox:1.36
          imagePullPolicy: IfNotPresent
          name: init-msp-tls
          resources: {}
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
          - mountPath: /msp-src
            name: msp-src
            readOnly: true
          - mountPath: /tls-src
            name: tls-src
            readOnly: true
          - mountPath: /var/hyperledger/orderer
            name: orderer-writable
        restartPolicy: Always
        schedulerName: default-scheduler
        securityContext: {}
        terminationGracePeriodSeconds: 30
        volumes:
        - emptyDir: {}
          name: orderer-writable
        - configMap:
            defaultMode: 420
            items:
            - key: orderer.yaml
              path: orderer.yaml
            name: fabric-orderer-config
          name: orderer-config
        - name: msp-src
          secret:
            defaultMode: 420
            secretName: orderer4-msp
        - name: tls-src
          secret:
            defaultMode: 420
            secretName: orderer4-tls
    updateStrategy:
      rollingUpdate:
        partition: 0
      type: RollingUpdate
    volumeClaimTemplates:
    - apiVersion: v1
      kind: PersistentVolumeClaim
      metadata:
        creationTimestamp: null
        name: ledger
      spec:
        accessModes:
        - ReadWriteOnce
        resources:
          requests:
            storage: 10Gi
        volumeMode: Filesystem
      status:
        phase: Pending
  status:
    availableReplicas: 1
    collisionCount: 0
    currentReplicas: 1
    currentRevision: orderer4-59b4c55d5d
    observedGeneration: 5
    readyReplicas: 1
    replicas: 1
    updateRevision: orderer4-59b4c55d5d
    updatedReplicas: 1
- apiVersion: v1
  kind: Pod
  metadata:
    annotations:
      checksum/orderer-config: 847267eef1b7741179ab0801a1210d616516545aecfc1494e47dd780d0f587c9
    creationTimestamp: "2025-08-08T23:37:09Z"
    generateName: orderer0-
    labels:
      app.kubernetes.io/component: orderer
      app.kubernetes.io/instance: fabric-orderer
      app.kubernetes.io/name: orderer0
      apps.kubernetes.io/pod-index: "0"
      controller-revision-hash: orderer0-65b6b95d
      helm.sh/chart: fabric-orderer-0.1.0
      statefulset.kubernetes.io/pod-name: orderer0-0
    name: orderer0-0
    namespace: hlf-orderer
    ownerReferences:
    - apiVersion: apps/v1
      blockOwnerDeletion: true
      controller: true
      kind: StatefulSet
      name: orderer0
      uid: 4d5578d5-f7ec-44b8-9404-300d3f2df5e4
    resourceVersion: "876746174"
    uid: 5ca8b5e9-040e-4556-8336-96c894c597c6
  spec:
    containers:
    - command:
      - orderer
      env:
      - name: FABRIC_LOGGING_SPEC
        value: INFO
      - name: ORDERER_GENERAL_LISTENADDRESS
        value: 0.0.0.0
      - name: ORDERER_GENERAL_LISTENPORT
        value: "7050"
      - name: ORDERER_GENERAL_LOCALMSPID
        value: OrdererMSP
      - name: ORDERER_GENERAL_LOCALMSPDIR
        value: /var/hyperledger/orderer/msp
      - name: ORDERER_GENERAL_TLS_ENABLED
        value: "true"
      - name: ORDERER_GENERAL_TLS_PRIVATEKEY
        value: /var/hyperledger/orderer/tls/server.key
      - name: ORDERER_GENERAL_TLS_CERTIFICATE
        value: /var/hyperledger/orderer/tls/server.crt
      - name: ORDERER_GENERAL_TLS_ROOTCAS
        value: '[/var/hyperledger/orderer/tls/ca.crt]'
      - name: ORDERER_GENERAL_CLUSTER_LISTENADDRESS
        value: 0.0.0.0
      - name: ORDERER_GENERAL_CLUSTER_LISTENPORT
        value: "7051"
      - name: ORDERER_GENERAL_CLUSTER_SERVERCERTIFICATE
        value: /var/hyperledger/orderer/tls/server.crt
      - name: ORDERER_GENERAL_CLUSTER_SERVERPRIVATEKEY
        value: /var/hyperledger/orderer/tls/server.key
      - name: ORDERER_GENERAL_CLUSTER_CLIENTCERTIFICATE
        value: /var/hyperledger/orderer/tls/server.crt
      - name: ORDERER_GENERAL_CLUSTER_CLIENTPRIVATEKEY
        value: /var/hyperledger/orderer/tls/server.key
      - name: ORDERER_GENERAL_CLUSTER_ROOTCAS
        value: '[/var/hyperledger/orderer/tls/ca.crt]'
      - name: ORDERER_CFGFILE
        value: /etc/hyperledger/fabric/orderer.yaml
      - name: ORDERER_GENERAL_BOOTSTRAPMETHOD
        value: none
      - name: ORDERER_OPERATIONS_LISTENADDRESS
        value: 0.0.0.0:9443
      - name: ORDERER_METRICS_PROVIDER
        value: prometheus
      image: hyperledger/fabric-orderer:2.5.7
      imagePullPolicy: IfNotPresent
      livenessProbe:
        failureThreshold: 6
        httpGet:
          path: /healthz
          port: operations
          scheme: HTTP
        initialDelaySeconds: 20
        periodSeconds: 20
        successThreshold: 1
        timeoutSeconds: 5
      name: orderer
      ports:
      - containerPort: 7050
        name: client
        protocol: TCP
      - containerPort: 7051
        name: cluster
        protocol: TCP
      - containerPort: 9443
        name: operations
        protocol: TCP
      readinessProbe:
        failureThreshold: 6
        httpGet:
          path: /healthz
          port: operations
          scheme: HTTP
        initialDelaySeconds: 10
        periodSeconds: 10
        successThreshold: 1
        timeoutSeconds: 3
      resources:
        limits:
          cpu: "1"
          memory: 2Gi
        requests:
          cpu: 250m
          memory: 512Mi
      terminationMessagePath: /dev/termination-log
      terminationMessagePolicy: File
      volumeMounts:
      - mountPath: /var/hyperledger/orderer
        name: orderer-writable
      - mountPath: /var/hyperledger/production/orderer
        name: ledger
      - mountPath: /etc/hyperledger/fabric
        name: orderer-config
        readOnly: true
      - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
        name: kube-api-access-g94v5
        readOnly: true
    dnsPolicy: ClusterFirst
    enableServiceLinks: true
    hostname: orderer0-0
    initContainers:
    - args:
      - |
        set -euo pipefail

        DEST=/var/hyperledger/orderer
        MSP=${DEST}/msp

        # Create MSP structure
        mkdir -p ${MSP}/cacerts ${MSP}/signcerts ${MSP}/keystore ${MSP}/tlscacerts

        # Copy MSP from secret (supports both structured and flat secrets)
        if [ -d /msp-src/cacerts ] || [ -d /msp-src/signcerts ] || [ -d /msp-src/keystore ]; then
          cp -a /msp-src/cacerts/*   ${MSP}/cacerts/   2>/dev/null || true
          cp -a /msp-src/signcerts/* ${MSP}/signcerts/ 2>/dev/null || true
          cp -a /msp-src/keystore/*  ${MSP}/keystore/  2>/dev/null || true
          [ -f /msp-src/config.yaml ] && cp /msp-src/config.yaml ${MSP}/config.yaml || true
        else
          # Flat secret: reconstruct layout from filenames
          if [ -f /msp-src/cert.pem ]; then
            cp /msp-src/cert.pem ${MSP}/signcerts/cert.pem
          else
            FIRST_CERT="$(ls -1 /msp-src/*.pem 2>/dev/null | grep -viE 'ca|root' | head -n1 || true)"
            [ -n "${FIRST_CERT}" ] && cp "${FIRST_CERT}" ${MSP}/signcerts/cert.pem || true
          fi
          SK="$(ls -1 /msp-src/*_sk 2>/dev/null | head -n1 || true)"
          [ -n "${SK}" ] && cp "${SK}" ${MSP}/keystore/ || true
          for f in /msp-src/*.pem; do
            [ -e "$f" ] || break
            bn="$(basename "$f")"
            echo "$bn" | grep -qiE 'ca|root|cacert' && cp "$f" ${MSP}/cacerts/ || true
          done
          [ -f /msp-src/config.yaml ] && cp /msp-src/config.yaml ${MSP}/config.yaml || true
        fi

        # TLS files (expect normalized names in the TLS secret)
        mkdir -p ${DEST}/tls
        cp /tls-src/server.crt ${DEST}/tls/server.crt
        cp /tls-src/server.key ${DEST}/tls/server.key
        cp /tls-src/ca.crt     ${DEST}/tls/ca.crt

        # Also place TLS CA into MSP tlscacerts (recommended)
        cp ${DEST}/tls/ca.crt ${MSP}/tlscacerts/tls-ca.pem

        # Tighten key perms
        chmod 600 ${MSP}/keystore/* 2>/dev/null || true
      command:
      - /bin/sh
      - -c
      image: busybox:1.36
      imagePullPolicy: IfNotPresent
      name: init-msp-tls
      resources: {}
      terminationMessagePath: /dev/termination-log
      terminationMessagePolicy: File
      volumeMounts:
      - mountPath: /msp-src
        name: msp-src
        readOnly: true
      - mountPath: /tls-src
        name: tls-src
        readOnly: true
      - mountPath: /var/hyperledger/orderer
        name: orderer-writable
      - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
        name: kube-api-access-g94v5
        readOnly: true
    nodeName: microservices-node-pool-l0iu1
    preemptionPolicy: PreemptLowerPriority
    priority: 0
    restartPolicy: Always
    schedulerName: default-scheduler
    securityContext: {}
    serviceAccount: default
    serviceAccountName: default
    subdomain: orderer0
    terminationGracePeriodSeconds: 30
    tolerations:
    - effect: NoExecute
      key: node.kubernetes.io/not-ready
      operator: Exists
      tolerationSeconds: 300
    - effect: NoExecute
      key: node.kubernetes.io/unreachable
      operator: Exists
      tolerationSeconds: 300
    volumes:
    - name: ledger
      persistentVolumeClaim:
        claimName: ledger-orderer0-0
    - emptyDir: {}
      name: orderer-writable
    - configMap:
        defaultMode: 420
        items:
        - key: orderer.yaml
          path: orderer.yaml
        name: fabric-orderer-config
      name: orderer-config
    - name: msp-src
      secret:
        defaultMode: 420
        secretName: orderer0-msp
    - name: tls-src
      secret:
        defaultMode: 420
        secretName: orderer0-tls
    - name: kube-api-access-g94v5
      projected:
        defaultMode: 420
        sources:
        - serviceAccountToken:
            expirationSeconds: 3607
            path: token
        - configMap:
            items:
            - key: ca.crt
              path: ca.crt
            name: kube-root-ca.crt
        - downwardAPI:
            items:
            - fieldRef:
                apiVersion: v1
                fieldPath: metadata.namespace
              path: namespace
  status:
    conditions:
    - lastProbeTime: null
      lastTransitionTime: "2025-08-08T23:37:12Z"
      status: "True"
      type: PodReadyToStartContainers
    - lastProbeTime: null
      lastTransitionTime: "2025-08-08T23:37:12Z"
      status: "True"
      type: Initialized
    - lastProbeTime: null
      lastTransitionTime: "2025-08-08T23:37:30Z"
      status: "True"
      type: Ready
    - lastProbeTime: null
      lastTransitionTime: "2025-08-08T23:37:30Z"
      status: "True"
      type: ContainersReady
    - lastProbeTime: null
      lastTransitionTime: "2025-08-08T23:37:09Z"
      status: "True"
      type: PodScheduled
    containerStatuses:
    - containerID: containerd://a3232093d22c724509928a556876ce4e459f72781f2f04dd996066524b93103b
      image: docker.io/hyperledger/fabric-orderer:2.5.7
      imageID: docker.io/hyperledger/fabric-orderer@sha256:e3933beae1d0d7e725f90c50f8d6acf89dc1b99291e2ba2571e722ecd04023a3
      lastState: {}
      name: orderer
      ready: true
      restartCount: 0
      started: true
      state:
        running:
          startedAt: "2025-08-08T23:37:12Z"
      volumeMounts:
      - mountPath: /var/hyperledger/orderer
        name: orderer-writable
      - mountPath: /var/hyperledger/production/orderer
        name: ledger
      - mountPath: /etc/hyperledger/fabric
        name: orderer-config
        readOnly: true
        recursiveReadOnly: Disabled
      - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
        name: kube-api-access-g94v5
        readOnly: true
        recursiveReadOnly: Disabled
    hostIP: 10.138.214.212
    hostIPs:
    - ip: 10.138.214.212
    initContainerStatuses:
    - containerID: containerd://002a9698a60f4c630695c3a77edf6f0cae1db2815a7652c16f02a11eb7e15895
      image: docker.io/library/busybox:1.36
      imageID: docker.io/library/busybox@sha256:31f3955f475e40c62c6d4209f09fd9738cf6cadfc0f4aa76ba2d4d86f061c5b5
      lastState: {}
      name: init-msp-tls
      ready: true
      restartCount: 0
      started: false
      state:
        terminated:
          containerID: containerd://002a9698a60f4c630695c3a77edf6f0cae1db2815a7652c16f02a11eb7e15895
          exitCode: 0
          finishedAt: "2025-08-08T23:37:11Z"
          reason: Completed
          startedAt: "2025-08-08T23:37:11Z"
      volumeMounts:
      - mountPath: /msp-src
        name: msp-src
        readOnly: true
        recursiveReadOnly: Disabled
      - mountPath: /tls-src
        name: tls-src
        readOnly: true
        recursiveReadOnly: Disabled
      - mountPath: /var/hyperledger/orderer
        name: orderer-writable
      - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
        name: kube-api-access-g94v5
        readOnly: true
        recursiveReadOnly: Disabled
    phase: Running
    podIP: 10.244.3.48
    podIPs:
    - ip: 10.244.3.48
    qosClass: Burstable
    startTime: "2025-08-08T23:37:09Z"
- apiVersion: v1
  kind: Pod
  metadata:
    annotations:
      checksum/orderer-config: 847267eef1b7741179ab0801a1210d616516545aecfc1494e47dd780d0f587c9
    creationTimestamp: "2025-08-08T23:48:45Z"
    generateName: orderer1-
    labels:
      app.kubernetes.io/component: orderer
      app.kubernetes.io/instance: fabric-orderer
      app.kubernetes.io/name: orderer1
      apps.kubernetes.io/pod-index: "0"
      controller-revision-hash: orderer1-56b8f568bf
      helm.sh/chart: fabric-orderer-0.1.0
      statefulset.kubernetes.io/pod-name: orderer1-0
    name: orderer1-0
    namespace: hlf-orderer
    ownerReferences:
    - apiVersion: apps/v1
      blockOwnerDeletion: true
      controller: true
      kind: StatefulSet
      name: orderer1
      uid: cfa714c5-ad5e-4217-934d-34a18c4db75e
    resourceVersion: "876750481"
    uid: 508baddb-ba41-49af-b879-9121c5d275af
  spec:
    containers:
    - command:
      - orderer
      env:
      - name: FABRIC_LOGGING_SPEC
        value: INFO
      - name: ORDERER_GENERAL_LISTENADDRESS
        value: 0.0.0.0
      - name: ORDERER_GENERAL_LISTENPORT
        value: "7050"
      - name: ORDERER_GENERAL_LOCALMSPID
        value: OrdererMSP
      - name: ORDERER_GENERAL_LOCALMSPDIR
        value: /var/hyperledger/orderer/msp
      - name: ORDERER_GENERAL_TLS_ENABLED
        value: "true"
      - name: ORDERER_GENERAL_TLS_PRIVATEKEY
        value: /var/hyperledger/orderer/tls/server.key
      - name: ORDERER_GENERAL_TLS_CERTIFICATE
        value: /var/hyperledger/orderer/tls/server.crt
      - name: ORDERER_GENERAL_TLS_ROOTCAS
        value: '[/var/hyperledger/orderer/tls/ca.crt]'
      - name: ORDERER_GENERAL_CLUSTER_LISTENADDRESS
        value: 0.0.0.0
      - name: ORDERER_GENERAL_CLUSTER_LISTENPORT
        value: "7051"
      - name: ORDERER_GENERAL_CLUSTER_SERVERCERTIFICATE
        value: /var/hyperledger/orderer/tls/server.crt
      - name: ORDERER_GENERAL_CLUSTER_SERVERPRIVATEKEY
        value: /var/hyperledger/orderer/tls/server.key
      - name: ORDERER_GENERAL_CLUSTER_CLIENTCERTIFICATE
        value: /var/hyperledger/orderer/tls/server.crt
      - name: ORDERER_GENERAL_CLUSTER_CLIENTPRIVATEKEY
        value: /var/hyperledger/orderer/tls/server.key
      - name: ORDERER_GENERAL_CLUSTER_ROOTCAS
        value: '[/var/hyperledger/orderer/tls/ca.crt]'
      - name: ORDERER_CFGFILE
        value: /etc/hyperledger/fabric/orderer.yaml
      - name: ORDERER_GENERAL_BOOTSTRAPMETHOD
        value: none
      - name: ORDERER_OPERATIONS_LISTENADDRESS
        value: 0.0.0.0:9443
      - name: ORDERER_METRICS_PROVIDER
        value: prometheus
      image: hyperledger/fabric-orderer:2.5.7
      imagePullPolicy: IfNotPresent
      livenessProbe:
        failureThreshold: 6
        httpGet:
          path: /healthz
          port: operations
          scheme: HTTP
        initialDelaySeconds: 20
        periodSeconds: 20
        successThreshold: 1
        timeoutSeconds: 5
      name: orderer
      ports:
      - containerPort: 7050
        name: client
        protocol: TCP
      - containerPort: 7051
        name: cluster
        protocol: TCP
      - containerPort: 9443
        name: operations
        protocol: TCP
      readinessProbe:
        failureThreshold: 6
        httpGet:
          path: /healthz
          port: operations
          scheme: HTTP
        initialDelaySeconds: 10
        periodSeconds: 10
        successThreshold: 1
        timeoutSeconds: 3
      resources:
        limits:
          cpu: "1"
          memory: 2Gi
        requests:
          cpu: 250m
          memory: 512Mi
      terminationMessagePath: /dev/termination-log
      terminationMessagePolicy: File
      volumeMounts:
      - mountPath: /var/hyperledger/orderer
        name: orderer-writable
      - mountPath: /var/hyperledger/production/orderer
        name: ledger
      - mountPath: /etc/hyperledger/fabric
        name: orderer-config
        readOnly: true
      - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
        name: kube-api-access-x56jg
        readOnly: true
    dnsPolicy: ClusterFirst
    enableServiceLinks: true
    hostname: orderer1-0
    initContainers:
    - args:
      - |
        set -euo pipefail

        DEST=/var/hyperledger/orderer
        MSP=${DEST}/msp

        # Create MSP structure
        mkdir -p ${MSP}/cacerts ${MSP}/signcerts ${MSP}/keystore ${MSP}/tlscacerts

        # Copy MSP from secret (supports both structured and flat secrets)
        if [ -d /msp-src/cacerts ] || [ -d /msp-src/signcerts ] || [ -d /msp-src/keystore ]; then
          cp -a /msp-src/cacerts/*   ${MSP}/cacerts/   2>/dev/null || true
          cp -a /msp-src/signcerts/* ${MSP}/signcerts/ 2>/dev/null || true
          cp -a /msp-src/keystore/*  ${MSP}/keystore/  2>/dev/null || true
          [ -f /msp-src/config.yaml ] && cp /msp-src/config.yaml ${MSP}/config.yaml || true
        else
          # Flat secret: reconstruct layout from filenames
          if [ -f /msp-src/cert.pem ]; then
            cp /msp-src/cert.pem ${MSP}/signcerts/cert.pem
          else
            FIRST_CERT="$(ls -1 /msp-src/*.pem 2>/dev/null | grep -viE 'ca|root' | head -n1 || true)"
            [ -n "${FIRST_CERT}" ] && cp "${FIRST_CERT}" ${MSP}/signcerts/cert.pem || true
          fi
          SK="$(ls -1 /msp-src/*_sk 2>/dev/null | head -n1 || true)"
          [ -n "${SK}" ] && cp "${SK}" ${MSP}/keystore/ || true
          for f in /msp-src/*.pem; do
            [ -e "$f" ] || break
            bn="$(basename "$f")"
            echo "$bn" | grep -qiE 'ca|root|cacert' && cp "$f" ${MSP}/cacerts/ || true
          done
          [ -f /msp-src/config.yaml ] && cp /msp-src/config.yaml ${MSP}/config.yaml || true
        fi

        # TLS files (expect normalized names in the TLS secret)
        mkdir -p ${DEST}/tls
        cp /tls-src/server.crt ${DEST}/tls/server.crt
        cp /tls-src/server.key ${DEST}/tls/server.key
        cp /tls-src/ca.crt     ${DEST}/tls/ca.crt

        # Also place TLS CA into MSP tlscacerts (recommended)
        cp ${DEST}/tls/ca.crt ${MSP}/tlscacerts/tls-ca.pem

        # Tighten key perms
        chmod 600 ${MSP}/keystore/* 2>/dev/null || true
      command:
      - /bin/sh
      - -c
      image: busybox:1.36
      imagePullPolicy: IfNotPresent
      name: init-msp-tls
      resources: {}
      terminationMessagePath: /dev/termination-log
      terminationMessagePolicy: File
      volumeMounts:
      - mountPath: /msp-src
        name: msp-src
        readOnly: true
      - mountPath: /tls-src
        name: tls-src
        readOnly: true
      - mountPath: /var/hyperledger/orderer
        name: orderer-writable
      - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
        name: kube-api-access-x56jg
        readOnly: true
    nodeName: microservices-node-pool-l0iu1
    preemptionPolicy: PreemptLowerPriority
    priority: 0
    restartPolicy: Always
    schedulerName: default-scheduler
    securityContext: {}
    serviceAccount: default
    serviceAccountName: default
    subdomain: orderer1
    terminationGracePeriodSeconds: 30
    tolerations:
    - effect: NoExecute
      key: node.kubernetes.io/not-ready
      operator: Exists
      tolerationSeconds: 300
    - effect: NoExecute
      key: node.kubernetes.io/unreachable
      operator: Exists
      tolerationSeconds: 300
    volumes:
    - name: ledger
      persistentVolumeClaim:
        claimName: ledger-orderer1-0
    - emptyDir: {}
      name: orderer-writable
    - configMap:
        defaultMode: 420
        items:
        - key: orderer.yaml
          path: orderer.yaml
        name: fabric-orderer-config
      name: orderer-config
    - name: msp-src
      secret:
        defaultMode: 420
        secretName: orderer1-msp
    - name: tls-src
      secret:
        defaultMode: 420
        secretName: orderer1-tls
    - name: kube-api-access-x56jg
      projected:
        defaultMode: 420
        sources:
        - serviceAccountToken:
            expirationSeconds: 3607
            path: token
        - configMap:
            items:
            - key: ca.crt
              path: ca.crt
            name: kube-root-ca.crt
        - downwardAPI:
            items:
            - fieldRef:
                apiVersion: v1
                fieldPath: metadata.namespace
              path: namespace
  status:
    conditions:
    - lastProbeTime: null
      lastTransitionTime: "2025-08-08T23:48:46Z"
      status: "True"
      type: PodReadyToStartContainers
    - lastProbeTime: null
      lastTransitionTime: "2025-08-08T23:48:47Z"
      status: "True"
      type: Initialized
    - lastProbeTime: null
      lastTransitionTime: "2025-08-08T23:49:05Z"
      status: "True"
      type: Ready
    - lastProbeTime: null
      lastTransitionTime: "2025-08-08T23:49:05Z"
      status: "True"
      type: ContainersReady
    - lastProbeTime: null
      lastTransitionTime: "2025-08-08T23:48:45Z"
      status: "True"
      type: PodScheduled
    containerStatuses:
    - containerID: containerd://42978510ff34d6c7512e3f7bcd87f6b4bcf0c6bd65efd962021d705f82cea7c5
      image: docker.io/hyperledger/fabric-orderer:2.5.7
      imageID: docker.io/hyperledger/fabric-orderer@sha256:e3933beae1d0d7e725f90c50f8d6acf89dc1b99291e2ba2571e722ecd04023a3
      lastState: {}
      name: orderer
      ready: true
      restartCount: 0
      started: true
      state:
        running:
          startedAt: "2025-08-08T23:48:47Z"
      volumeMounts:
      - mountPath: /var/hyperledger/orderer
        name: orderer-writable
      - mountPath: /var/hyperledger/production/orderer
        name: ledger
      - mountPath: /etc/hyperledger/fabric
        name: orderer-config
        readOnly: true
        recursiveReadOnly: Disabled
      - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
        name: kube-api-access-x56jg
        readOnly: true
        recursiveReadOnly: Disabled
    hostIP: 10.138.214.212
    hostIPs:
    - ip: 10.138.214.212
    initContainerStatuses:
    - containerID: containerd://a788539076d7e4b30422b48c043cd1ca5743a9b8fb17d1c3d59e39af8f3c17a8
      image: docker.io/library/busybox:1.36
      imageID: docker.io/library/busybox@sha256:31f3955f475e40c62c6d4209f09fd9738cf6cadfc0f4aa76ba2d4d86f061c5b5
      lastState: {}
      name: init-msp-tls
      ready: true
      restartCount: 0
      started: false
      state:
        terminated:
          containerID: containerd://a788539076d7e4b30422b48c043cd1ca5743a9b8fb17d1c3d59e39af8f3c17a8
          exitCode: 0
          finishedAt: "2025-08-08T23:48:46Z"
          reason: Completed
          startedAt: "2025-08-08T23:48:46Z"
      volumeMounts:
      - mountPath: /msp-src
        name: msp-src
        readOnly: true
        recursiveReadOnly: Disabled
      - mountPath: /tls-src
        name: tls-src
        readOnly: true
        recursiveReadOnly: Disabled
      - mountPath: /var/hyperledger/orderer
        name: orderer-writable
      - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
        name: kube-api-access-x56jg
        readOnly: true
        recursiveReadOnly: Disabled
    phase: Running
    podIP: 10.244.3.49
    podIPs:
    - ip: 10.244.3.49
    qosClass: Burstable
    startTime: "2025-08-08T23:48:45Z"
- apiVersion: v1
  kind: Pod
  metadata:
    annotations:
      checksum/orderer-config: 847267eef1b7741179ab0801a1210d616516545aecfc1494e47dd780d0f587c9
    creationTimestamp: "2025-08-08T23:37:09Z"
    generateName: orderer2-
    labels:
      app.kubernetes.io/component: orderer
      app.kubernetes.io/instance: fabric-orderer
      app.kubernetes.io/name: orderer2
      apps.kubernetes.io/pod-index: "0"
      controller-revision-hash: orderer2-fcbcf5f5b
      helm.sh/chart: fabric-orderer-0.1.0
      statefulset.kubernetes.io/pod-name: orderer2-0
    name: orderer2-0
    namespace: hlf-orderer
    ownerReferences:
    - apiVersion: apps/v1
      blockOwnerDeletion: true
      controller: true
      kind: StatefulSet
      name: orderer2
      uid: be33322a-a051-46e8-a4b0-1d811f7eb8d5
    resourceVersion: "876746321"
    uid: d011b7e7-9954-4498-9f4e-0ba01ff51620
  spec:
    containers:
    - command:
      - orderer
      env:
      - name: FABRIC_LOGGING_SPEC
        value: INFO
      - name: ORDERER_GENERAL_LISTENADDRESS
        value: 0.0.0.0
      - name: ORDERER_GENERAL_LISTENPORT
        value: "7050"
      - name: ORDERER_GENERAL_LOCALMSPID
        value: OrdererMSP
      - name: ORDERER_GENERAL_LOCALMSPDIR
        value: /var/hyperledger/orderer/msp
      - name: ORDERER_GENERAL_TLS_ENABLED
        value: "true"
      - name: ORDERER_GENERAL_TLS_PRIVATEKEY
        value: /var/hyperledger/orderer/tls/server.key
      - name: ORDERER_GENERAL_TLS_CERTIFICATE
        value: /var/hyperledger/orderer/tls/server.crt
      - name: ORDERER_GENERAL_TLS_ROOTCAS
        value: '[/var/hyperledger/orderer/tls/ca.crt]'
      - name: ORDERER_GENERAL_CLUSTER_LISTENADDRESS
        value: 0.0.0.0
      - name: ORDERER_GENERAL_CLUSTER_LISTENPORT
        value: "7051"
      - name: ORDERER_GENERAL_CLUSTER_SERVERCERTIFICATE
        value: /var/hyperledger/orderer/tls/server.crt
      - name: ORDERER_GENERAL_CLUSTER_SERVERPRIVATEKEY
        value: /var/hyperledger/orderer/tls/server.key
      - name: ORDERER_GENERAL_CLUSTER_CLIENTCERTIFICATE
        value: /var/hyperledger/orderer/tls/server.crt
      - name: ORDERER_GENERAL_CLUSTER_CLIENTPRIVATEKEY
        value: /var/hyperledger/orderer/tls/server.key
      - name: ORDERER_GENERAL_CLUSTER_ROOTCAS
        value: '[/var/hyperledger/orderer/tls/ca.crt]'
      - name: ORDERER_CFGFILE
        value: /etc/hyperledger/fabric/orderer.yaml
      - name: ORDERER_GENERAL_BOOTSTRAPMETHOD
        value: none
      - name: ORDERER_OPERATIONS_LISTENADDRESS
        value: 0.0.0.0:9443
      - name: ORDERER_METRICS_PROVIDER
        value: prometheus
      image: hyperledger/fabric-orderer:2.5.7
      imagePullPolicy: IfNotPresent
      livenessProbe:
        failureThreshold: 6
        httpGet:
          path: /healthz
          port: operations
          scheme: HTTP
        initialDelaySeconds: 20
        periodSeconds: 20
        successThreshold: 1
        timeoutSeconds: 5
      name: orderer
      ports:
      - containerPort: 7050
        name: client
        protocol: TCP
      - containerPort: 7051
        name: cluster
        protocol: TCP
      - containerPort: 9443
        name: operations
        protocol: TCP
      readinessProbe:
        failureThreshold: 6
        httpGet:
          path: /healthz
          port: operations
          scheme: HTTP
        initialDelaySeconds: 10
        periodSeconds: 10
        successThreshold: 1
        timeoutSeconds: 3
      resources:
        limits:
          cpu: "1"
          memory: 2Gi
        requests:
          cpu: 250m
          memory: 512Mi
      terminationMessagePath: /dev/termination-log
      terminationMessagePolicy: File
      volumeMounts:
      - mountPath: /var/hyperledger/orderer
        name: orderer-writable
      - mountPath: /var/hyperledger/production/orderer
        name: ledger
      - mountPath: /etc/hyperledger/fabric
        name: orderer-config
        readOnly: true
      - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
        name: kube-api-access-hg42z
        readOnly: true
    dnsPolicy: ClusterFirst
    enableServiceLinks: true
    hostname: orderer2-0
    initContainers:
    - args:
      - |
        set -euo pipefail

        DEST=/var/hyperledger/orderer
        MSP=${DEST}/msp

        # Create MSP structure
        mkdir -p ${MSP}/cacerts ${MSP}/signcerts ${MSP}/keystore ${MSP}/tlscacerts

        # Copy MSP from secret (supports both structured and flat secrets)
        if [ -d /msp-src/cacerts ] || [ -d /msp-src/signcerts ] || [ -d /msp-src/keystore ]; then
          cp -a /msp-src/cacerts/*   ${MSP}/cacerts/   2>/dev/null || true
          cp -a /msp-src/signcerts/* ${MSP}/signcerts/ 2>/dev/null || true
          cp -a /msp-src/keystore/*  ${MSP}/keystore/  2>/dev/null || true
          [ -f /msp-src/config.yaml ] && cp /msp-src/config.yaml ${MSP}/config.yaml || true
        else
          # Flat secret: reconstruct layout from filenames
          if [ -f /msp-src/cert.pem ]; then
            cp /msp-src/cert.pem ${MSP}/signcerts/cert.pem
          else
            FIRST_CERT="$(ls -1 /msp-src/*.pem 2>/dev/null | grep -viE 'ca|root' | head -n1 || true)"
            [ -n "${FIRST_CERT}" ] && cp "${FIRST_CERT}" ${MSP}/signcerts/cert.pem || true
          fi
          SK="$(ls -1 /msp-src/*_sk 2>/dev/null | head -n1 || true)"
          [ -n "${SK}" ] && cp "${SK}" ${MSP}/keystore/ || true
          for f in /msp-src/*.pem; do
            [ -e "$f" ] || break
            bn="$(basename "$f")"
            echo "$bn" | grep -qiE 'ca|root|cacert' && cp "$f" ${MSP}/cacerts/ || true
          done
          [ -f /msp-src/config.yaml ] && cp /msp-src/config.yaml ${MSP}/config.yaml || true
        fi

        # TLS files (expect normalized names in the TLS secret)
        mkdir -p ${DEST}/tls
        cp /tls-src/server.crt ${DEST}/tls/server.crt
        cp /tls-src/server.key ${DEST}/tls/server.key
        cp /tls-src/ca.crt     ${DEST}/tls/ca.crt

        # Also place TLS CA into MSP tlscacerts (recommended)
        cp ${DEST}/tls/ca.crt ${MSP}/tlscacerts/tls-ca.pem

        # Tighten key perms
        chmod 600 ${MSP}/keystore/* 2>/dev/null || true
      command:
      - /bin/sh
      - -c
      image: busybox:1.36
      imagePullPolicy: IfNotPresent
      name: init-msp-tls
      resources: {}
      terminationMessagePath: /dev/termination-log
      terminationMessagePolicy: File
      volumeMounts:
      - mountPath: /msp-src
        name: msp-src
        readOnly: true
      - mountPath: /tls-src
        name: tls-src
        readOnly: true
      - mountPath: /var/hyperledger/orderer
        name: orderer-writable
      - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
        name: kube-api-access-hg42z
        readOnly: true
    nodeName: cloud-services-node-pool-l04od
    preemptionPolicy: PreemptLowerPriority
    priority: 0
    restartPolicy: Always
    schedulerName: default-scheduler
    securityContext: {}
    serviceAccount: default
    serviceAccountName: default
    subdomain: orderer2
    terminationGracePeriodSeconds: 30
    tolerations:
    - effect: NoExecute
      key: node.kubernetes.io/not-ready
      operator: Exists
      tolerationSeconds: 300
    - effect: NoExecute
      key: node.kubernetes.io/unreachable
      operator: Exists
      tolerationSeconds: 300
    volumes:
    - name: ledger
      persistentVolumeClaim:
        claimName: ledger-orderer2-0
    - emptyDir: {}
      name: orderer-writable
    - configMap:
        defaultMode: 420
        items:
        - key: orderer.yaml
          path: orderer.yaml
        name: fabric-orderer-config
      name: orderer-config
    - name: msp-src
      secret:
        defaultMode: 420
        secretName: orderer2-msp
    - name: tls-src
      secret:
        defaultMode: 420
        secretName: orderer2-tls
    - name: kube-api-access-hg42z
      projected:
        defaultMode: 420
        sources:
        - serviceAccountToken:
            expirationSeconds: 3607
            path: token
        - configMap:
            items:
            - key: ca.crt
              path: ca.crt
            name: kube-root-ca.crt
        - downwardAPI:
            items:
            - fieldRef:
                apiVersion: v1
                fieldPath: metadata.namespace
              path: namespace
  status:
    conditions:
    - lastProbeTime: null
      lastTransitionTime: "2025-08-08T23:37:31Z"
      status: "True"
      type: PodReadyToStartContainers
    - lastProbeTime: null
      lastTransitionTime: "2025-08-08T23:37:31Z"
      status: "True"
      type: Initialized
    - lastProbeTime: null
      lastTransitionTime: "2025-08-08T23:37:50Z"
      status: "True"
      type: Ready
    - lastProbeTime: null
      lastTransitionTime: "2025-08-08T23:37:50Z"
      status: "True"
      type: ContainersReady
    - lastProbeTime: null
      lastTransitionTime: "2025-08-08T23:37:09Z"
      status: "True"
      type: PodScheduled
    containerStatuses:
    - containerID: containerd://c5a65faa8157d774a402c7f72105a9faa27449cde825c89f2db32d54fb54722e
      image: docker.io/hyperledger/fabric-orderer:2.5.7
      imageID: docker.io/hyperledger/fabric-orderer@sha256:e3933beae1d0d7e725f90c50f8d6acf89dc1b99291e2ba2571e722ecd04023a3
      lastState: {}
      name: orderer
      ready: true
      restartCount: 0
      started: true
      state:
        running:
          startedAt: "2025-08-08T23:37:31Z"
      volumeMounts:
      - mountPath: /var/hyperledger/orderer
        name: orderer-writable
      - mountPath: /var/hyperledger/production/orderer
        name: ledger
      - mountPath: /etc/hyperledger/fabric
        name: orderer-config
        readOnly: true
        recursiveReadOnly: Disabled
      - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
        name: kube-api-access-hg42z
        readOnly: true
        recursiveReadOnly: Disabled
    hostIP: 10.138.214.236
    hostIPs:
    - ip: 10.138.214.236
    initContainerStatuses:
    - containerID: containerd://5c5a50481d3130b654a954932d409df1c7ac79011702a4b3013e146b329a5cad
      image: docker.io/library/busybox:1.36
      imageID: docker.io/library/busybox@sha256:31f3955f475e40c62c6d4209f09fd9738cf6cadfc0f4aa76ba2d4d86f061c5b5
      lastState: {}
      name: init-msp-tls
      ready: true
      restartCount: 0
      started: false
      state:
        terminated:
          containerID: containerd://5c5a50481d3130b654a954932d409df1c7ac79011702a4b3013e146b329a5cad
          exitCode: 0
          finishedAt: "2025-08-08T23:37:30Z"
          reason: Completed
          startedAt: "2025-08-08T23:37:30Z"
      volumeMounts:
      - mountPath: /msp-src
        name: msp-src
        readOnly: true
        recursiveReadOnly: Disabled
      - mountPath: /tls-src
        name: tls-src
        readOnly: true
        recursiveReadOnly: Disabled
      - mountPath: /var/hyperledger/orderer
        name: orderer-writable
      - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
        name: kube-api-access-hg42z
        readOnly: true
        recursiveReadOnly: Disabled
    phase: Running
    podIP: 10.244.1.224
    podIPs:
    - ip: 10.244.1.224
    qosClass: Burstable
    startTime: "2025-08-08T23:37:09Z"
- apiVersion: v1
  kind: Pod
  metadata:
    annotations:
      checksum/orderer-config: 847267eef1b7741179ab0801a1210d616516545aecfc1494e47dd780d0f587c9
    creationTimestamp: "2025-08-08T23:37:09Z"
    generateName: orderer3-
    labels:
      app.kubernetes.io/component: orderer
      app.kubernetes.io/instance: fabric-orderer
      app.kubernetes.io/name: orderer3
      apps.kubernetes.io/pod-index: "0"
      controller-revision-hash: orderer3-c564f5559
      helm.sh/chart: fabric-orderer-0.1.0
      statefulset.kubernetes.io/pod-name: orderer3-0
    name: orderer3-0
    namespace: hlf-orderer
    ownerReferences:
    - apiVersion: apps/v1
      blockOwnerDeletion: true
      controller: true
      kind: StatefulSet
      name: orderer3
      uid: 61d4b921-942f-4777-a7e4-a2db20965276
    resourceVersion: "876746328"
    uid: d3b880f8-4163-4500-a82b-151e8e016485
  spec:
    containers:
    - command:
      - orderer
      env:
      - name: FABRIC_LOGGING_SPEC
        value: INFO
      - name: ORDERER_GENERAL_LISTENADDRESS
        value: 0.0.0.0
      - name: ORDERER_GENERAL_LISTENPORT
        value: "7050"
      - name: ORDERER_GENERAL_LOCALMSPID
        value: OrdererMSP
      - name: ORDERER_GENERAL_LOCALMSPDIR
        value: /var/hyperledger/orderer/msp
      - name: ORDERER_GENERAL_TLS_ENABLED
        value: "true"
      - name: ORDERER_GENERAL_TLS_PRIVATEKEY
        value: /var/hyperledger/orderer/tls/server.key
      - name: ORDERER_GENERAL_TLS_CERTIFICATE
        value: /var/hyperledger/orderer/tls/server.crt
      - name: ORDERER_GENERAL_TLS_ROOTCAS
        value: '[/var/hyperledger/orderer/tls/ca.crt]'
      - name: ORDERER_GENERAL_CLUSTER_LISTENADDRESS
        value: 0.0.0.0
      - name: ORDERER_GENERAL_CLUSTER_LISTENPORT
        value: "7051"
      - name: ORDERER_GENERAL_CLUSTER_SERVERCERTIFICATE
        value: /var/hyperledger/orderer/tls/server.crt
      - name: ORDERER_GENERAL_CLUSTER_SERVERPRIVATEKEY
        value: /var/hyperledger/orderer/tls/server.key
      - name: ORDERER_GENERAL_CLUSTER_CLIENTCERTIFICATE
        value: /var/hyperledger/orderer/tls/server.crt
      - name: ORDERER_GENERAL_CLUSTER_CLIENTPRIVATEKEY
        value: /var/hyperledger/orderer/tls/server.key
      - name: ORDERER_GENERAL_CLUSTER_ROOTCAS
        value: '[/var/hyperledger/orderer/tls/ca.crt]'
      - name: ORDERER_CFGFILE
        value: /etc/hyperledger/fabric/orderer.yaml
      - name: ORDERER_GENERAL_BOOTSTRAPMETHOD
        value: none
      - name: ORDERER_OPERATIONS_LISTENADDRESS
        value: 0.0.0.0:9443
      - name: ORDERER_METRICS_PROVIDER
        value: prometheus
      image: hyperledger/fabric-orderer:2.5.7
      imagePullPolicy: IfNotPresent
      livenessProbe:
        failureThreshold: 6
        httpGet:
          path: /healthz
          port: operations
          scheme: HTTP
        initialDelaySeconds: 20
        periodSeconds: 20
        successThreshold: 1
        timeoutSeconds: 5
      name: orderer
      ports:
      - containerPort: 7050
        name: client
        protocol: TCP
      - containerPort: 7051
        name: cluster
        protocol: TCP
      - containerPort: 9443
        name: operations
        protocol: TCP
      readinessProbe:
        failureThreshold: 6
        httpGet:
          path: /healthz
          port: operations
          scheme: HTTP
        initialDelaySeconds: 10
        periodSeconds: 10
        successThreshold: 1
        timeoutSeconds: 3
      resources:
        limits:
          cpu: "1"
          memory: 2Gi
        requests:
          cpu: 250m
          memory: 512Mi
      terminationMessagePath: /dev/termination-log
      terminationMessagePolicy: File
      volumeMounts:
      - mountPath: /var/hyperledger/orderer
        name: orderer-writable
      - mountPath: /var/hyperledger/production/orderer
        name: ledger
      - mountPath: /etc/hyperledger/fabric
        name: orderer-config
        readOnly: true
      - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
        name: kube-api-access-vbm7b
        readOnly: true
    dnsPolicy: ClusterFirst
    enableServiceLinks: true
    hostname: orderer3-0
    initContainers:
    - args:
      - |
        set -euo pipefail

        DEST=/var/hyperledger/orderer
        MSP=${DEST}/msp

        # Create MSP structure
        mkdir -p ${MSP}/cacerts ${MSP}/signcerts ${MSP}/keystore ${MSP}/tlscacerts

        # Copy MSP from secret (supports both structured and flat secrets)
        if [ -d /msp-src/cacerts ] || [ -d /msp-src/signcerts ] || [ -d /msp-src/keystore ]; then
          cp -a /msp-src/cacerts/*   ${MSP}/cacerts/   2>/dev/null || true
          cp -a /msp-src/signcerts/* ${MSP}/signcerts/ 2>/dev/null || true
          cp -a /msp-src/keystore/*  ${MSP}/keystore/  2>/dev/null || true
          [ -f /msp-src/config.yaml ] && cp /msp-src/config.yaml ${MSP}/config.yaml || true
        else
          # Flat secret: reconstruct layout from filenames
          if [ -f /msp-src/cert.pem ]; then
            cp /msp-src/cert.pem ${MSP}/signcerts/cert.pem
          else
            FIRST_CERT="$(ls -1 /msp-src/*.pem 2>/dev/null | grep -viE 'ca|root' | head -n1 || true)"
            [ -n "${FIRST_CERT}" ] && cp "${FIRST_CERT}" ${MSP}/signcerts/cert.pem || true
          fi
          SK="$(ls -1 /msp-src/*_sk 2>/dev/null | head -n1 || true)"
          [ -n "${SK}" ] && cp "${SK}" ${MSP}/keystore/ || true
          for f in /msp-src/*.pem; do
            [ -e "$f" ] || break
            bn="$(basename "$f")"
            echo "$bn" | grep -qiE 'ca|root|cacert' && cp "$f" ${MSP}/cacerts/ || true
          done
          [ -f /msp-src/config.yaml ] && cp /msp-src/config.yaml ${MSP}/config.yaml || true
        fi

        # TLS files (expect normalized names in the TLS secret)
        mkdir -p ${DEST}/tls
        cp /tls-src/server.crt ${DEST}/tls/server.crt
        cp /tls-src/server.key ${DEST}/tls/server.key
        cp /tls-src/ca.crt     ${DEST}/tls/ca.crt

        # Also place TLS CA into MSP tlscacerts (recommended)
        cp ${DEST}/tls/ca.crt ${MSP}/tlscacerts/tls-ca.pem

        # Tighten key perms
        chmod 600 ${MSP}/keystore/* 2>/dev/null || true
      command:
      - /bin/sh
      - -c
      image: busybox:1.36
      imagePullPolicy: IfNotPresent
      name: init-msp-tls
      resources: {}
      terminationMessagePath: /dev/termination-log
      terminationMessagePolicy: File
      volumeMounts:
      - mountPath: /msp-src
        name: msp-src
        readOnly: true
      - mountPath: /tls-src
        name: tls-src
        readOnly: true
      - mountPath: /var/hyperledger/orderer
        name: orderer-writable
      - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
        name: kube-api-access-vbm7b
        readOnly: true
    nodeName: microservices-node-pool-l0iu0
    preemptionPolicy: PreemptLowerPriority
    priority: 0
    restartPolicy: Always
    schedulerName: default-scheduler
    securityContext: {}
    serviceAccount: default
    serviceAccountName: default
    subdomain: orderer3
    terminationGracePeriodSeconds: 30
    tolerations:
    - effect: NoExecute
      key: node.kubernetes.io/not-ready
      operator: Exists
      tolerationSeconds: 300
    - effect: NoExecute
      key: node.kubernetes.io/unreachable
      operator: Exists
      tolerationSeconds: 300
    volumes:
    - name: ledger
      persistentVolumeClaim:
        claimName: ledger-orderer3-0
    - emptyDir: {}
      name: orderer-writable
    - configMap:
        defaultMode: 420
        items:
        - key: orderer.yaml
          path: orderer.yaml
        name: fabric-orderer-config
      name: orderer-config
    - name: msp-src
      secret:
        defaultMode: 420
        secretName: orderer3-msp
    - name: tls-src
      secret:
        defaultMode: 420
        secretName: orderer3-tls
    - name: kube-api-access-vbm7b
      projected:
        defaultMode: 420
        sources:
        - serviceAccountToken:
            expirationSeconds: 3607
            path: token
        - configMap:
            items:
            - key: ca.crt
              path: ca.crt
            name: kube-root-ca.crt
        - downwardAPI:
            items:
            - fieldRef:
                apiVersion: v1
                fieldPath: metadata.namespace
              path: namespace
  status:
    conditions:
    - lastProbeTime: null
      lastTransitionTime: "2025-08-08T23:37:31Z"
      status: "True"
      type: PodReadyToStartContainers
    - lastProbeTime: null
      lastTransitionTime: "2025-08-08T23:37:32Z"
      status: "True"
      type: Initialized
    - lastProbeTime: null
      lastTransitionTime: "2025-08-08T23:37:51Z"
      status: "True"
      type: Ready
    - lastProbeTime: null
      lastTransitionTime: "2025-08-08T23:37:51Z"
      status: "True"
      type: ContainersReady
    - lastProbeTime: null
      lastTransitionTime: "2025-08-08T23:37:09Z"
      status: "True"
      type: PodScheduled
    containerStatuses:
    - containerID: containerd://0812bf2a6d32fbcaf724de7c9a3e5bd8a6523f8ccf183c2dbf75c37f76d9084f
      image: docker.io/hyperledger/fabric-orderer:2.5.7
      imageID: docker.io/hyperledger/fabric-orderer@sha256:e3933beae1d0d7e725f90c50f8d6acf89dc1b99291e2ba2571e722ecd04023a3
      lastState: {}
      name: orderer
      ready: true
      restartCount: 0
      started: true
      state:
        running:
          startedAt: "2025-08-08T23:37:33Z"
      volumeMounts:
      - mountPath: /var/hyperledger/orderer
        name: orderer-writable
      - mountPath: /var/hyperledger/production/orderer
        name: ledger
      - mountPath: /etc/hyperledger/fabric
        name: orderer-config
        readOnly: true
        recursiveReadOnly: Disabled
      - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
        name: kube-api-access-vbm7b
        readOnly: true
        recursiveReadOnly: Disabled
    hostIP: 10.138.214.217
    hostIPs:
    - ip: 10.138.214.217
    initContainerStatuses:
    - containerID: containerd://3c89e239d68a9fe425043af22f2f84957ac10af133dcac35020b1d1ab83176b3
      image: docker.io/library/busybox:1.36
      imageID: docker.io/library/busybox@sha256:31f3955f475e40c62c6d4209f09fd9738cf6cadfc0f4aa76ba2d4d86f061c5b5
      lastState: {}
      name: init-msp-tls
      ready: true
      restartCount: 0
      started: false
      state:
        terminated:
          containerID: containerd://3c89e239d68a9fe425043af22f2f84957ac10af133dcac35020b1d1ab83176b3
          exitCode: 0
          finishedAt: "2025-08-08T23:37:31Z"
          reason: Completed
          startedAt: "2025-08-08T23:37:31Z"
      volumeMounts:
      - mountPath: /msp-src
        name: msp-src
        readOnly: true
        recursiveReadOnly: Disabled
      - mountPath: /tls-src
        name: tls-src
        readOnly: true
        recursiveReadOnly: Disabled
      - mountPath: /var/hyperledger/orderer
        name: orderer-writable
      - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
        name: kube-api-access-vbm7b
        readOnly: true
        recursiveReadOnly: Disabled
    phase: Running
    podIP: 10.244.3.244
    podIPs:
    - ip: 10.244.3.244
    qosClass: Burstable
    startTime: "2025-08-08T23:37:09Z"
- apiVersion: v1
  kind: Pod
  metadata:
    annotations:
      checksum/orderer-config: 847267eef1b7741179ab0801a1210d616516545aecfc1494e47dd780d0f587c9
    creationTimestamp: "2025-08-08T23:37:10Z"
    generateName: orderer4-
    labels:
      app.kubernetes.io/component: orderer
      app.kubernetes.io/instance: fabric-orderer
      app.kubernetes.io/name: orderer4
      apps.kubernetes.io/pod-index: "0"
      controller-revision-hash: orderer4-59b4c55d5d
      helm.sh/chart: fabric-orderer-0.1.0
      statefulset.kubernetes.io/pod-name: orderer4-0
    name: orderer4-0
    namespace: hlf-orderer
    ownerReferences:
    - apiVersion: apps/v1
      blockOwnerDeletion: true
      controller: true
      kind: StatefulSet
      name: orderer4
      uid: a3d29e1d-72b0-499a-b7c7-9dd367445ef6
    resourceVersion: "876746309"
    uid: f7479c90-9377-47e3-b6e7-385cf66d262a
  spec:
    containers:
    - command:
      - orderer
      env:
      - name: FABRIC_LOGGING_SPEC
        value: INFO
      - name: ORDERER_GENERAL_LISTENADDRESS
        value: 0.0.0.0
      - name: ORDERER_GENERAL_LISTENPORT
        value: "7050"
      - name: ORDERER_GENERAL_LOCALMSPID
        value: OrdererMSP
      - name: ORDERER_GENERAL_LOCALMSPDIR
        value: /var/hyperledger/orderer/msp
      - name: ORDERER_GENERAL_TLS_ENABLED
        value: "true"
      - name: ORDERER_GENERAL_TLS_PRIVATEKEY
        value: /var/hyperledger/orderer/tls/server.key
      - name: ORDERER_GENERAL_TLS_CERTIFICATE
        value: /var/hyperledger/orderer/tls/server.crt
      - name: ORDERER_GENERAL_TLS_ROOTCAS
        value: '[/var/hyperledger/orderer/tls/ca.crt]'
      - name: ORDERER_GENERAL_CLUSTER_LISTENADDRESS
        value: 0.0.0.0
      - name: ORDERER_GENERAL_CLUSTER_LISTENPORT
        value: "7051"
      - name: ORDERER_GENERAL_CLUSTER_SERVERCERTIFICATE
        value: /var/hyperledger/orderer/tls/server.crt
      - name: ORDERER_GENERAL_CLUSTER_SERVERPRIVATEKEY
        value: /var/hyperledger/orderer/tls/server.key
      - name: ORDERER_GENERAL_CLUSTER_CLIENTCERTIFICATE
        value: /var/hyperledger/orderer/tls/server.crt
      - name: ORDERER_GENERAL_CLUSTER_CLIENTPRIVATEKEY
        value: /var/hyperledger/orderer/tls/server.key
      - name: ORDERER_GENERAL_CLUSTER_ROOTCAS
        value: '[/var/hyperledger/orderer/tls/ca.crt]'
      - name: ORDERER_CFGFILE
        value: /etc/hyperledger/fabric/orderer.yaml
      - name: ORDERER_GENERAL_BOOTSTRAPMETHOD
        value: none
      - name: ORDERER_OPERATIONS_LISTENADDRESS
        value: 0.0.0.0:9443
      - name: ORDERER_METRICS_PROVIDER
        value: prometheus
      image: hyperledger/fabric-orderer:2.5.7
      imagePullPolicy: IfNotPresent
      livenessProbe:
        failureThreshold: 6
        httpGet:
          path: /healthz
          port: operations
          scheme: HTTP
        initialDelaySeconds: 20
        periodSeconds: 20
        successThreshold: 1
        timeoutSeconds: 5
      name: orderer
      ports:
      - containerPort: 7050
        name: client
        protocol: TCP
      - containerPort: 7051
        name: cluster
        protocol: TCP
      - containerPort: 9443
        name: operations
        protocol: TCP
      readinessProbe:
        failureThreshold: 6
        httpGet:
          path: /healthz
          port: operations
          scheme: HTTP
        initialDelaySeconds: 10
        periodSeconds: 10
        successThreshold: 1
        timeoutSeconds: 3
      resources:
        limits:
          cpu: "1"
          memory: 2Gi
        requests:
          cpu: 250m
          memory: 512Mi
      terminationMessagePath: /dev/termination-log
      terminationMessagePolicy: File
      volumeMounts:
      - mountPath: /var/hyperledger/orderer
        name: orderer-writable
      - mountPath: /var/hyperledger/production/orderer
        name: ledger
      - mountPath: /etc/hyperledger/fabric
        name: orderer-config
        readOnly: true
      - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
        name: kube-api-access-f7bks
        readOnly: true
    dnsPolicy: ClusterFirst
    enableServiceLinks: true
    hostname: orderer4-0
    initContainers:
    - args:
      - |
        set -euo pipefail

        DEST=/var/hyperledger/orderer
        MSP=${DEST}/msp

        # Create MSP structure
        mkdir -p ${MSP}/cacerts ${MSP}/signcerts ${MSP}/keystore ${MSP}/tlscacerts

        # Copy MSP from secret (supports both structured and flat secrets)
        if [ -d /msp-src/cacerts ] || [ -d /msp-src/signcerts ] || [ -d /msp-src/keystore ]; then
          cp -a /msp-src/cacerts/*   ${MSP}/cacerts/   2>/dev/null || true
          cp -a /msp-src/signcerts/* ${MSP}/signcerts/ 2>/dev/null || true
          cp -a /msp-src/keystore/*  ${MSP}/keystore/  2>/dev/null || true
          [ -f /msp-src/config.yaml ] && cp /msp-src/config.yaml ${MSP}/config.yaml || true
        else
          # Flat secret: reconstruct layout from filenames
          if [ -f /msp-src/cert.pem ]; then
            cp /msp-src/cert.pem ${MSP}/signcerts/cert.pem
          else
            FIRST_CERT="$(ls -1 /msp-src/*.pem 2>/dev/null | grep -viE 'ca|root' | head -n1 || true)"
            [ -n "${FIRST_CERT}" ] && cp "${FIRST_CERT}" ${MSP}/signcerts/cert.pem || true
          fi
          SK="$(ls -1 /msp-src/*_sk 2>/dev/null | head -n1 || true)"
          [ -n "${SK}" ] && cp "${SK}" ${MSP}/keystore/ || true
          for f in /msp-src/*.pem; do
            [ -e "$f" ] || break
            bn="$(basename "$f")"
            echo "$bn" | grep -qiE 'ca|root|cacert' && cp "$f" ${MSP}/cacerts/ || true
          done
          [ -f /msp-src/config.yaml ] && cp /msp-src/config.yaml ${MSP}/config.yaml || true
        fi

        # TLS files (expect normalized names in the TLS secret)
        mkdir -p ${DEST}/tls
        cp /tls-src/server.crt ${DEST}/tls/server.crt
        cp /tls-src/server.key ${DEST}/tls/server.key
        cp /tls-src/ca.crt     ${DEST}/tls/ca.crt

        # Also place TLS CA into MSP tlscacerts (recommended)
        cp ${DEST}/tls/ca.crt ${MSP}/tlscacerts/tls-ca.pem

        # Tighten key perms
        chmod 600 ${MSP}/keystore/* 2>/dev/null || true
      command:
      - /bin/sh
      - -c
      image: busybox:1.36
      imagePullPolicy: IfNotPresent
      name: init-msp-tls
      resources: {}
      terminationMessagePath: /dev/termination-log
      terminationMessagePolicy: File
      volumeMounts:
      - mountPath: /msp-src
        name: msp-src
        readOnly: true
      - mountPath: /tls-src
        name: tls-src
        readOnly: true
      - mountPath: /var/hyperledger/orderer
        name: orderer-writable
      - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
        name: kube-api-access-f7bks
        readOnly: true
    nodeName: cloud-services-node-pool-l04od
    preemptionPolicy: PreemptLowerPriority
    priority: 0
    restartPolicy: Always
    schedulerName: default-scheduler
    securityContext: {}
    serviceAccount: default
    serviceAccountName: default
    subdomain: orderer4
    terminationGracePeriodSeconds: 30
    tolerations:
    - effect: NoExecute
      key: node.kubernetes.io/not-ready
      operator: Exists
      tolerationSeconds: 300
    - effect: NoExecute
      key: node.kubernetes.io/unreachable
      operator: Exists
      tolerationSeconds: 300
    volumes:
    - name: ledger
      persistentVolumeClaim:
        claimName: ledger-orderer4-0
    - emptyDir: {}
      name: orderer-writable
    - configMap:
        defaultMode: 420
        items:
        - key: orderer.yaml
          path: orderer.yaml
        name: fabric-orderer-config
      name: orderer-config
    - name: msp-src
      secret:
        defaultMode: 420
        secretName: orderer4-msp
    - name: tls-src
      secret:
        defaultMode: 420
        secretName: orderer4-tls
    - name: kube-api-access-f7bks
      projected:
        defaultMode: 420
        sources:
        - serviceAccountToken:
            expirationSeconds: 3607
            path: token
        - configMap:
            items:
            - key: ca.crt
              path: ca.crt
            name: kube-root-ca.crt
        - downwardAPI:
            items:
            - fieldRef:
                apiVersion: v1
                fieldPath: metadata.namespace
              path: namespace
  status:
    conditions:
    - lastProbeTime: null
      lastTransitionTime: "2025-08-08T23:37:29Z"
      status: "True"
      type: PodReadyToStartContainers
    - lastProbeTime: null
      lastTransitionTime: "2025-08-08T23:37:29Z"
      status: "True"
      type: Initialized
    - lastProbeTime: null
      lastTransitionTime: "2025-08-08T23:37:48Z"
      status: "True"
      type: Ready
    - lastProbeTime: null
      lastTransitionTime: "2025-08-08T23:37:48Z"
      status: "True"
      type: ContainersReady
    - lastProbeTime: null
      lastTransitionTime: "2025-08-08T23:37:10Z"
      status: "True"
      type: PodScheduled
    containerStatuses:
    - containerID: containerd://8b46a6299c800b13ae50708e7a604fb526327468434414f9dfd692988c3f9910
      image: docker.io/hyperledger/fabric-orderer:2.5.7
      imageID: docker.io/hyperledger/fabric-orderer@sha256:e3933beae1d0d7e725f90c50f8d6acf89dc1b99291e2ba2571e722ecd04023a3
      lastState: {}
      name: orderer
      ready: true
      restartCount: 0
      started: true
      state:
        running:
          startedAt: "2025-08-08T23:37:29Z"
      volumeMounts:
      - mountPath: /var/hyperledger/orderer
        name: orderer-writable
      - mountPath: /var/hyperledger/production/orderer
        name: ledger
      - mountPath: /etc/hyperledger/fabric
        name: orderer-config
        readOnly: true
        recursiveReadOnly: Disabled
      - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
        name: kube-api-access-f7bks
        readOnly: true
        recursiveReadOnly: Disabled
    hostIP: 10.138.214.236
    hostIPs:
    - ip: 10.138.214.236
    initContainerStatuses:
    - containerID: containerd://b13c833f0a1644b76bf62a64a4bdd0a039cd59fda49ed35c2c92270597cce2c5
      image: docker.io/library/busybox:1.36
      imageID: docker.io/library/busybox@sha256:31f3955f475e40c62c6d4209f09fd9738cf6cadfc0f4aa76ba2d4d86f061c5b5
      lastState: {}
      name: init-msp-tls
      ready: true
      restartCount: 0
      started: false
      state:
        terminated:
          containerID: containerd://b13c833f0a1644b76bf62a64a4bdd0a039cd59fda49ed35c2c92270597cce2c5
          exitCode: 0
          finishedAt: "2025-08-08T23:37:29Z"
          reason: Completed
          startedAt: "2025-08-08T23:37:29Z"
      volumeMounts:
      - mountPath: /msp-src
        name: msp-src
        readOnly: true
        recursiveReadOnly: Disabled
      - mountPath: /tls-src
        name: tls-src
        readOnly: true
        recursiveReadOnly: Disabled
      - mountPath: /var/hyperledger/orderer
        name: orderer-writable
      - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
        name: kube-api-access-f7bks
        readOnly: true
        recursiveReadOnly: Disabled
    phase: Running
    podIP: 10.244.1.242
    podIPs:
    - ip: 10.244.1.242
    qosClass: Burstable
    startTime: "2025-08-08T23:37:10Z"
- apiVersion: v1
  kind: Service
  metadata:
    annotations:
      meta.helm.sh/release-name: fabric-orderer
      meta.helm.sh/release-namespace: hlf-orderer
    creationTimestamp: "2025-08-08T22:55:32Z"
    labels:
      app.kubernetes.io/component: orderer
      app.kubernetes.io/instance: fabric-orderer
      app.kubernetes.io/managed-by: Helm
      app.kubernetes.io/name: orderer0
      helm.sh/chart: fabric-orderer-0.1.0
    name: orderer0
    namespace: hlf-orderer
    resourceVersion: "876729697"
    uid: 3d24f082-0273-4fad-90cb-d59f6a22f963
  spec:
    clusterIP: 10.245.172.197
    clusterIPs:
    - 10.245.172.197
    internalTrafficPolicy: Cluster
    ipFamilies:
    - IPv4
    ipFamilyPolicy: SingleStack
    ports:
    - name: client
      port: 7050
      protocol: TCP
      targetPort: 7050
    - name: cluster
      port: 7051
      protocol: TCP
      targetPort: 7051
    - name: operations
      port: 9443
      protocol: TCP
      targetPort: 9443
    selector:
      app.kubernetes.io/component: orderer
      app.kubernetes.io/name: orderer0
    sessionAffinity: None
    type: ClusterIP
  status:
    loadBalancer: {}
- apiVersion: v1
  kind: Service
  metadata:
    annotations:
      meta.helm.sh/release-name: fabric-orderer
      meta.helm.sh/release-namespace: hlf-orderer
    creationTimestamp: "2025-08-08T22:55:32Z"
    labels:
      app.kubernetes.io/component: orderer
      app.kubernetes.io/instance: fabric-orderer
      app.kubernetes.io/managed-by: Helm
      app.kubernetes.io/name: orderer1
      helm.sh/chart: fabric-orderer-0.1.0
    name: orderer1
    namespace: hlf-orderer
    resourceVersion: "876729705"
    uid: 3150d7a1-61d9-4b84-9d33-0519d3d741f1
  spec:
    clusterIP: 10.245.233.204
    clusterIPs:
    - 10.245.233.204
    internalTrafficPolicy: Cluster
    ipFamilies:
    - IPv4
    ipFamilyPolicy: SingleStack
    ports:
    - name: client
      port: 7050
      protocol: TCP
      targetPort: 7050
    - name: cluster
      port: 7051
      protocol: TCP
      targetPort: 7051
    - name: operations
      port: 9443
      protocol: TCP
      targetPort: 9443
    selector:
      app.kubernetes.io/component: orderer
      app.kubernetes.io/name: orderer1
    sessionAffinity: None
    type: ClusterIP
  status:
    loadBalancer: {}
- apiVersion: v1
  kind: Service
  metadata:
    annotations:
      meta.helm.sh/release-name: fabric-orderer
      meta.helm.sh/release-namespace: hlf-orderer
    creationTimestamp: "2025-08-08T22:55:32Z"
    labels:
      app.kubernetes.io/component: orderer
      app.kubernetes.io/instance: fabric-orderer
      app.kubernetes.io/managed-by: Helm
      app.kubernetes.io/name: orderer2
      helm.sh/chart: fabric-orderer-0.1.0
    name: orderer2
    namespace: hlf-orderer
    resourceVersion: "876729711"
    uid: 581e3053-94f3-4883-9140-38d736e882dc
  spec:
    clusterIP: 10.245.192.228
    clusterIPs:
    - 10.245.192.228
    internalTrafficPolicy: Cluster
    ipFamilies:
    - IPv4
    ipFamilyPolicy: SingleStack
    ports:
    - name: client
      port: 7050
      protocol: TCP
      targetPort: 7050
    - name: cluster
      port: 7051
      protocol: TCP
      targetPort: 7051
    - name: operations
      port: 9443
      protocol: TCP
      targetPort: 9443
    selector:
      app.kubernetes.io/component: orderer
      app.kubernetes.io/name: orderer2
    sessionAffinity: None
    type: ClusterIP
  status:
    loadBalancer: {}
- apiVersion: v1
  kind: Service
  metadata:
    annotations:
      meta.helm.sh/release-name: fabric-orderer
      meta.helm.sh/release-namespace: hlf-orderer
    creationTimestamp: "2025-08-08T22:55:32Z"
    labels:
      app.kubernetes.io/component: orderer
      app.kubernetes.io/instance: fabric-orderer
      app.kubernetes.io/managed-by: Helm
      app.kubernetes.io/name: orderer3
      helm.sh/chart: fabric-orderer-0.1.0
    name: orderer3
    namespace: hlf-orderer
    resourceVersion: "876729703"
    uid: 95072449-270e-4fee-a2ce-0fdb4f7ee772
  spec:
    clusterIP: 10.245.31.188
    clusterIPs:
    - 10.245.31.188
    internalTrafficPolicy: Cluster
    ipFamilies:
    - IPv4
    ipFamilyPolicy: SingleStack
    ports:
    - name: client
      port: 7050
      protocol: TCP
      targetPort: 7050
    - name: cluster
      port: 7051
      protocol: TCP
      targetPort: 7051
    - name: operations
      port: 9443
      protocol: TCP
      targetPort: 9443
    selector:
      app.kubernetes.io/component: orderer
      app.kubernetes.io/name: orderer3
    sessionAffinity: None
    type: ClusterIP
  status:
    loadBalancer: {}
- apiVersion: v1
  kind: Service
  metadata:
    annotations:
      meta.helm.sh/release-name: fabric-orderer
      meta.helm.sh/release-namespace: hlf-orderer
    creationTimestamp: "2025-08-08T22:55:32Z"
    labels:
      app.kubernetes.io/component: orderer
      app.kubernetes.io/instance: fabric-orderer
      app.kubernetes.io/managed-by: Helm
      app.kubernetes.io/name: orderer4
      helm.sh/chart: fabric-orderer-0.1.0
    name: orderer4
    namespace: hlf-orderer
    resourceVersion: "876729696"
    uid: c5953b32-36e3-498d-ba36-536f060ab68e
  spec:
    clusterIP: 10.245.240.84
    clusterIPs:
    - 10.245.240.84
    internalTrafficPolicy: Cluster
    ipFamilies:
    - IPv4
    ipFamilyPolicy: SingleStack
    ports:
    - name: client
      port: 7050
      protocol: TCP
      targetPort: 7050
    - name: cluster
      port: 7051
      protocol: TCP
      targetPort: 7051
    - name: operations
      port: 9443
      protocol: TCP
      targetPort: 9443
    selector:
      app.kubernetes.io/component: orderer
      app.kubernetes.io/name: orderer4
    sessionAffinity: None
    type: ClusterIP
  status:
    loadBalancer: {}
- apiVersion: v1
  kind: Endpoints
  metadata:
    annotations:
      endpoints.kubernetes.io/last-change-trigger-time: "2025-08-08T23:37:30Z"
    creationTimestamp: "2025-08-08T22:55:32Z"
    labels:
      app.kubernetes.io/component: orderer
      app.kubernetes.io/instance: fabric-orderer
      app.kubernetes.io/managed-by: Helm
      app.kubernetes.io/name: orderer0
      helm.sh/chart: fabric-orderer-0.1.0
    name: orderer0
    namespace: hlf-orderer
    resourceVersion: "876746175"
    uid: d70a8adf-3637-4b05-b9c0-f69780bbfe17
  subsets:
  - addresses:
    - hostname: orderer0-0
      ip: 10.244.3.48
      nodeName: microservices-node-pool-l0iu1
      targetRef:
        kind: Pod
        name: orderer0-0
        namespace: hlf-orderer
        uid: 5ca8b5e9-040e-4556-8336-96c894c597c6
    ports:
    - name: operations
      port: 9443
      protocol: TCP
    - name: client
      port: 7050
      protocol: TCP
    - name: cluster
      port: 7051
      protocol: TCP
- apiVersion: v1
  kind: Endpoints
  metadata:
    annotations:
      endpoints.kubernetes.io/last-change-trigger-time: "2025-08-08T23:49:05Z"
    creationTimestamp: "2025-08-08T22:55:32Z"
    labels:
      app.kubernetes.io/component: orderer
      app.kubernetes.io/instance: fabric-orderer
      app.kubernetes.io/managed-by: Helm
      app.kubernetes.io/name: orderer1
      helm.sh/chart: fabric-orderer-0.1.0
    name: orderer1
    namespace: hlf-orderer
    resourceVersion: "876750483"
    uid: 29df2455-36a6-4f58-b57d-e05269bfe4c1
  subsets:
  - addresses:
    - hostname: orderer1-0
      ip: 10.244.3.49
      nodeName: microservices-node-pool-l0iu1
      targetRef:
        kind: Pod
        name: orderer1-0
        namespace: hlf-orderer
        uid: 508baddb-ba41-49af-b879-9121c5d275af
    ports:
    - name: operations
      port: 9443
      protocol: TCP
    - name: client
      port: 7050
      protocol: TCP
    - name: cluster
      port: 7051
      protocol: TCP
- apiVersion: v1
  kind: Endpoints
  metadata:
    annotations:
      endpoints.kubernetes.io/last-change-trigger-time: "2025-08-08T23:37:50Z"
    creationTimestamp: "2025-08-08T22:55:32Z"
    labels:
      app.kubernetes.io/component: orderer
      app.kubernetes.io/instance: fabric-orderer
      app.kubernetes.io/managed-by: Helm
      app.kubernetes.io/name: orderer2
      helm.sh/chart: fabric-orderer-0.1.0
    name: orderer2
    namespace: hlf-orderer
    resourceVersion: "876746323"
    uid: 5575749e-5b92-43c7-bf30-0a91e91dfb52
  subsets:
  - addresses:
    - hostname: orderer2-0
      ip: 10.244.1.224
      nodeName: cloud-services-node-pool-l04od
      targetRef:
        kind: Pod
        name: orderer2-0
        namespace: hlf-orderer
        uid: d011b7e7-9954-4498-9f4e-0ba01ff51620
    ports:
    - name: operations
      port: 9443
      protocol: TCP
    - name: client
      port: 7050
      protocol: TCP
    - name: cluster
      port: 7051
      protocol: TCP
- apiVersion: v1
  kind: Endpoints
  metadata:
    annotations:
      endpoints.kubernetes.io/last-change-trigger-time: "2025-08-08T23:37:51Z"
    creationTimestamp: "2025-08-08T22:55:32Z"
    labels:
      app.kubernetes.io/component: orderer
      app.kubernetes.io/instance: fabric-orderer
      app.kubernetes.io/managed-by: Helm
      app.kubernetes.io/name: orderer3
      helm.sh/chart: fabric-orderer-0.1.0
    name: orderer3
    namespace: hlf-orderer
    resourceVersion: "876746329"
    uid: ee497aa9-b98a-450d-9caf-c12c2b215404
  subsets:
  - addresses:
    - hostname: orderer3-0
      ip: 10.244.3.244
      nodeName: microservices-node-pool-l0iu0
      targetRef:
        kind: Pod
        name: orderer3-0
        namespace: hlf-orderer
        uid: d3b880f8-4163-4500-a82b-151e8e016485
    ports:
    - name: operations
      port: 9443
      protocol: TCP
    - name: client
      port: 7050
      protocol: TCP
    - name: cluster
      port: 7051
      protocol: TCP
- apiVersion: v1
  kind: Endpoints
  metadata:
    annotations:
      endpoints.kubernetes.io/last-change-trigger-time: "2025-08-08T23:37:48Z"
    creationTimestamp: "2025-08-08T22:55:32Z"
    labels:
      app.kubernetes.io/component: orderer
      app.kubernetes.io/instance: fabric-orderer
      app.kubernetes.io/managed-by: Helm
      app.kubernetes.io/name: orderer4
      helm.sh/chart: fabric-orderer-0.1.0
    name: orderer4
    namespace: hlf-orderer
    resourceVersion: "876746310"
    uid: 75e05365-9be4-4398-ab07-348875b1ab3f
  subsets:
  - addresses:
    - hostname: orderer4-0
      ip: 10.244.1.242
      nodeName: cloud-services-node-pool-l04od
      targetRef:
        kind: Pod
        name: orderer4-0
        namespace: hlf-orderer
        uid: f7479c90-9377-47e3-b6e7-385cf66d262a
    ports:
    - name: operations
      port: 9443
      protocol: TCP
    - name: client
      port: 7050
      protocol: TCP
    - name: cluster
      port: 7051
      protocol: TCP
kind: List
metadata:
  resourceVersion: ""
